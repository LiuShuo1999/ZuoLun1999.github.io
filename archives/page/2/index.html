<!DOCTYPE html>

<html lang="zh-CN">

<head>
  
  <title>文章归档 - 左轮</title>
  <meta charset="UTF-8">
  <meta name="description" content="欢迎">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  
  

  <link rel="shortcut icon" href="/favicon.ico" type="image/png" />
  <meta name="description" content="欢迎">
<meta property="og:type" content="website">
<meta property="og:title" content="左轮">
<meta property="og:url" content="http://liushuo1999.github.io/archives/page/2/index.html">
<meta property="og:site_name" content="左轮">
<meta property="og:description" content="欢迎">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="LiuShuo">
<meta name="twitter:card" content="summary">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/highlight.js@9.15.8/styles/atom-one-dark.css,npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css,gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css,npm/hexo-theme-nexmoe@latest/source/lib/mdui_043tiny/css/mdui.css,npm/hexo-theme-nexmoe@latest/source/lib/iconfont/iconfont.css?v=233" crossorigin>
  <link rel="stylesheet" href="/css/style.css?v=1620466069044">
  
  <link rel="stylesheet" href="/css/style.css?v=1620466069044">
  <link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1620466069044">
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="左轮" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="LiuShuo" class="mdui-btn mdui-btn-icon"><img src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/avatar.png" alt="LiuShuo"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="LiuShuo">
            <img src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/avatar.png" alt="LiuShuo" alt="LiuShuo">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>25</div>
        <div><span>标签</span>27</div>
        <div><span>分类</span>3</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about.html" title="关于博客">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博客
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/PY.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        <form id="search_form" action_e="https://cn.bing.com/search?q=site:nexmoe.com" onsubmit="return search();">
            <label><input id="search_value" name="q" type="search" placeholder="搜索"></label>
        </form>
    </div>
</div>
  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://jq.qq.com/?_wv=1027&k=5CfKHun" target="_blank" mdui-tooltip="{content: 'QQ群'}" style="color: rgb(249, 174, 8);background-color: rgba(249, 174, 8, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="https://space.bilibili.com/20238211" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/nexmoe/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/DistributedComputing/">DistributedComputing</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/distributed-computing/">distributed-computing</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/生活/">生活</a>
          <span class="category-list-count">3</span>
        </li>

        
      </ul>

    </div>
  </div>


  
  
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/DP/" style="font-size: 10px;">DP</a> <a href="/tags/IDM-%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98/" style="font-size: 10px;">IDM 百度网盘</a> <a href="/tags/PODC/" style="font-size: 13.33px;">PODC</a> <a href="/tags/QT/" style="font-size: 13.33px;">QT</a> <a href="/tags/STL/" style="font-size: 13.33px;">STL</a> <a href="/tags/TCP%E9%80%9A%E8%AE%AF/" style="font-size: 10px;">TCP通讯</a> <a href="/tags/Ukkonen/" style="font-size: 10px;">Ukkonen</a> <a href="/tags/distributed-computing/" style="font-size: 13.33px;">distributed-computing</a> <a href="/tags/map/" style="font-size: 10px;">map</a> <a href="/tags/vector/" style="font-size: 10px;">vector</a> <a href="/tags/%E4%B9%A6%E7%B1%8D/" style="font-size: 10px;">书籍</a> <a href="/tags/%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F/" style="font-size: 10px;">全局变量</a> <a href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" style="font-size: 16.67px;">动态规划</a> <a href="/tags/%E5%90%8E%E7%BC%80%E6%A0%91/" style="font-size: 10px;">后缀树</a> <a href="/tags/%E5%BD%B1%E8%AF%84/" style="font-size: 10px;">影评</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 10px;">总结</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">数据结构</a> <a href="/tags/%E6%97%A5%E8%AE%B0/" style="font-size: 10px;">日记</a> <a href="/tags/%E6%B8%B8%E8%AE%B0/" style="font-size: 10px;">游记</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 20px;">生活</a> <a href="/tags/%E7%94%B5%E5%BD%B1/" style="font-size: 10px;">电影</a> <a href="/tags/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/" style="font-size: 20px;">程序设计</a> <a href="/tags/%E7%AE%80%E5%8E%86/" style="font-size: 10px;">简历</a> <a href="/tags/%E8%AE%A1%E7%BD%91%E8%AF%BE%E8%AE%BE/" style="font-size: 10px;">计网课设</a> <a href="/tags/%E9%94%99%E9%A2%98/" style="font-size: 13.33px;">错题</a> <a href="/tags/%E9%9A%8F%E8%AE%B0/" style="font-size: 10px;">随记</a> <a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">面向对象编程</a>
    </div>
    
  </div>

  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2021 LiuShuo
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        
    </div>
</div><!-- .nexmoe-drawer -->
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <section class="nexmoe-posts">
    
    <div class="nexmoe-post">
        <a href="/2020/05/27/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E6%80%BB%E7%BB%93/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="程序设计总结" class="lazyload">
                    <h1>程序设计总结</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow-fill">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年05月27日</a>
            <a><i class="nexmoefont icon-areachart"></i>152 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <p>程序设计，练习代码能力，养成自己的代码风格。</p>
<p>总结该学期知识</p>
<h3 id="第一周"><a href="#第一周" class="headerlink" title="第一周"></a>第一周</h3><h3 id="第二周"><a href="#第二周" class="headerlink" title="第二周"></a>第二周</h3><h3 id="第三周"><a href="#第三周" class="headerlink" title="第三周"></a>第三周</h3><h3 id="第四周"><a href="#第四周" class="headerlink" title="第四周"></a>第四周</h3><h3 id="第五周"><a href="#第五周" class="headerlink" title="第五周"></a>第五周</h3><h3 id="第六周"><a href="#第六周" class="headerlink" title="第六周"></a>第六周</h3><h3 id="第七周"><a href="#第七周" class="headerlink" title="第七周"></a>第七周</h3><h3 id="第八周"><a href="#第八周" class="headerlink" title="第八周"></a>第八周</h3><h3 id="第九周"><a href="#第九周" class="headerlink" title="第九周"></a>第九周</h3><h3 id="第十周-动态规划-一"><a href="#第十周-动态规划-一" class="headerlink" title="第十周    动态规划(一)"></a>第十周    动态规划(一)</h3><p>通往总结</p>
<p><a href="https://vjudge.net/contest/369589#overview" target="_blank" rel="noopener">通往作业</a></p>
<table>
<thead>
<tr>
<th>习题</th>
<th>类型</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://vjudge.net/problem/CodeForces-1141A" target="_blank" rel="noopener">A - 签到题</a></td>
<td>动态规划</td>
</tr>
<tr>
<td><a href="https://vjudge.net/problem/Gym-277140A" target="_blank" rel="noopener">B - LIS &amp; LCS</a></td>
<td>最长上升序列，最长公共序列</td>
</tr>
<tr>
<td><a href="https://vjudge.net/problem/CodeForces-455A" target="_blank" rel="noopener">C - 拿数问题 II</a></td>
<td>动态规划</td>
</tr>
</tbody></table>
<p><a href="https://vjudge.net/contest/369421#problem/A" target="_blank" rel="noopener">通往大模拟</a></p>
<p><a href="https://blog.csdn.net/weixin_44552961/article/details/106392927" target="_blank" rel="noopener">通往大模拟题解</a></p>
<h3 id="第十一周-动态规划-二"><a href="#第十一周-动态规划-二" class="headerlink" title="第十一周    动态规划(二)"></a>第十一周    动态规划(二)</h3><h3 id="第十二周"><a href="#第十二周" class="headerlink" title="第十二周"></a>第十二周</h3><h3 id="第十三周"><a href="#第十三周" class="headerlink" title="第十三周"></a>第十三周</h3><h3 id="第十四周"><a href="#第十四周" class="headerlink" title="第十四周"></a>第十四周</h3><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h1 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a>知识点总结</h1><p>1、快速幂和快速乘</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/05/26/vector-%E5%8E%BB%E9%87%8D/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="vector 去重" class="lazyload">
                    <h1>vector 去重</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow-fill">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年05月26日</a>
            <a><i class="nexmoefont icon-areachart"></i>15 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <h2 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h2><pre class=" language-cpp"><code class="language-cpp"><span class="token function">sort</span><span class="token punctuation">(</span>vector<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>vector<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

vector<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span>vector<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>vector<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vector<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/05/19/QT%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="QT全局变量声明" class="lazyload">
                    <h1>QT全局变量声明</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow-fill">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年05月19日</a>
            <a><i class="nexmoefont icon-areachart"></i>30 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <p>可以另开一个头文件，里面声明一个类，类里面的全局变量声明为static类型；</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/05/16/QT-TCP%E9%80%9A%E8%AE%AF/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="QT-TCP通讯" class="lazyload">
                    <h1>QT-TCP通讯</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow-fill">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年05月16日</a>
            <a><i class="nexmoefont icon-areachart"></i>4,639 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 25 分钟</a>
        </div>

        <article>
            
                <p>[toc]</p>
<h4 id="实现内容"><a href="#实现内容" class="headerlink" title="实现内容"></a>实现内容</h4><ul>
<li>多人聊天室</li>
<li>文件传输</li>
<li>多人语音聊天室</li>
</ul>
<h4 id="效果截图"><a href="#效果截图" class="headerlink" title="效果截图"></a>效果截图</h4><h5 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h5><p><img data-fancybox="gallery" data-sizes="auto" data-src="/.io//C:%5CUsers%5Clenovo%5CDesktop%5C12.png" alt="服务器" class="lazyload"></p>
<h5 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h5><p><img data-fancybox="gallery" data-sizes="auto" data-src="/.io//C:%5CUsers%5Clenovo%5CDesktop%5C12.png" alt="12" class="lazyload"></p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><h5 id="服务器端-1"><a href="#服务器端-1" class="headerlink" title="服务器端"></a>服务器端</h5><p>注 pro文件需要添加</p>
<p><code>QT       += core gui network multimedia</code></p>
<h6 id="serverwidget-h"><a href="#serverwidget-h" class="headerlink" title="serverwidget.h"></a>serverwidget.h</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">ifndef</span> SERVERWIDGET_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> SERVERWIDGET_H</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QWidget></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTcpServer></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTcpSocket></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QVector></span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFile></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTimer></span></span><span class="token comment" spellcheck="true">//计时器</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudio></span></span><span class="token comment" spellcheck="true">//一下这五个是QT处理音频的库</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudioFormat></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudioInput></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudioOutput></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QIODevice></span></span>

QT_BEGIN_NAMESPACE
<span class="token keyword">namespace</span> Ui <span class="token punctuation">{</span> <span class="token keyword">class</span> <span class="token class-name">ServerWidget</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
QT_END_NAMESPACE

<span class="token keyword">struct</span> people<span class="token punctuation">{</span>
    QString pip<span class="token punctuation">;</span>
    QString name<span class="token punctuation">;</span>
    <span class="token keyword">int</span> pport<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">/*********************************************/</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> file_flag <span class="token operator">=</span> <span class="token string">'F'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> head_flag <span class="token operator">=</span> <span class="token string">'H'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> QString MSG_flag <span class="token operator">=</span> <span class="token string">"MSG##"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> sys_flag <span class="token operator">=</span> <span class="token string">'!'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> people_new <span class="token operator">=</span> <span class="token string">'N'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//新的用户到来  姓名传输过来</span>

<span class="token keyword">const</span> <span class="token keyword">char</span> to_c_people_new <span class="token operator">=</span> <span class="token string">'P'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//新的用户到来  传给客户端</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> to_c_people_del <span class="token operator">=</span> <span class="token string">'D'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//新的用户离开  传给客户端</span>

<span class="token comment" spellcheck="true">/*********************************************/</span>


<span class="token keyword">class</span> <span class="token class-name">ServerWidget</span> <span class="token operator">:</span> <span class="token keyword">public</span> QWidget
<span class="token punctuation">{</span>
    Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">ServerWidget</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">ServerWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> slots<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">on_pushButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//</span>
    <span class="token keyword">void</span> <span class="token function">on_ButtonSelect_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">on_ButtonSend_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">sendData</span><span class="token punctuation">(</span>QTcpSocket<span class="token operator">*</span> tcpSocket<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//发送文件数据</span>

    <span class="token keyword">void</span> <span class="token function">onReadyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">readyReadSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//receive</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    Ui<span class="token operator">::</span>ServerWidget <span class="token operator">*</span>ui<span class="token punctuation">;</span>

    QTcpServer <span class="token operator">*</span>tcpserver<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//监听套接字</span>
    QVector<span class="token operator">&lt;</span>QTcpSocket <span class="token operator">*</span><span class="token operator">></span> socketarr<span class="token punctuation">;</span>

    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    QFile  file<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件对象</span>
    QString fileName<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//文件名字</span>
    QString filePath<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//文件路径</span>
    qint64 fileSize<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件大小</span>
    qint64 sendSize<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//已发送文件大小</span>

        QTimer timer<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//定时器  黏包  头部----文件体</span>

    QFile  file2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件对象</span>
    QString fileName2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件名字</span>
    qint64 fileSize2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件大小</span>
    qint64 recvSize2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//已发送文件大小</span>

    <span class="token keyword">bool</span> readyFile<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/*********************************************/</span>
    QVector<span class="token operator">&lt;</span>people<span class="token operator">></span> plist<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/*********************************************/</span>

    <span class="token comment" spellcheck="true">/*音频*/</span>
    QVector<span class="token operator">&lt;</span>QTcpSocket <span class="token operator">*</span><span class="token operator">></span> phonetcpsocket<span class="token punctuation">;</span>
    QTcpServer <span class="token operator">*</span>phonetcpserver<span class="token punctuation">;</span>
    <span class="token keyword">int</span> phone_count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    QAudioInput <span class="token operator">*</span>input<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//音频采集</span>
    QIODevice   <span class="token operator">*</span>inputDevice<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//播放</span>
    QAudioOutput <span class="token operator">*</span>output<span class="token punctuation">;</span>
    QIODevice   <span class="token operator">*</span>outputDevice<span class="token punctuation">;</span>



<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> video<span class="token punctuation">{</span>
    <span class="token keyword">char</span> audiodata<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> lens<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment" spellcheck="true">// SERVERWIDGET_H</span></code></pre>
<h6 id="serverwidget-cpp"><a href="#serverwidget-cpp" class="headerlink" title="serverwidget.cpp"></a>serverwidget.cpp</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"serverwidget.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ui_serverwidget.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFileDialog></span></span><span class="token comment" spellcheck="true">//选择文件的对话框</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QDebug></span></span><span class="token comment" spellcheck="true">//用于debug</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFileInfo></span></span><span class="token comment" spellcheck="true">//用于获取文件信息</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QMap></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QStyleFactory></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QPainter></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QMessageBox></span></span>

ServerWidget<span class="token operator">::</span><span class="token function">ServerWidget</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">QWidget</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token function">ui</span><span class="token punctuation">(</span><span class="token keyword">new</span> Ui<span class="token operator">::</span>ServerWidget<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    ui<span class="token operator">-</span><span class="token operator">></span><span class="token function">setupUi</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tcpserver <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    recvSize2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    readyFile <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    tcpserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QTcpServer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//监听套接字</span>

    ui<span class="token operator">-</span><span class="token operator">></span>pushButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color: rgb(175,238,238)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>textEdit_online<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color: rgba(255, 0, 255, 60)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>textEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color: rgba(0, 255, 255, 60)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>textEditFile<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color: rgba(255, 0, 255, 60)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">1024</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>sendSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    QPainter <span class="token function">p</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">drawPixmap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">QPixmap</span><span class="token punctuation">(</span><span class="token string">"../src/b3.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

ServerWidget<span class="token operator">::</span><span class="token operator">~</span><span class="token function">ServerWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">delete</span> ui<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//聊天室按钮</span>
<span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">on_pushButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//获取端口号</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ui<span class="token operator">-</span><span class="token operator">></span>lineEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>
    qint16 port <span class="token operator">=</span> ui<span class="token operator">-</span><span class="token operator">></span>lineEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//监听</span>
    tcpserver<span class="token operator">-</span><span class="token operator">></span><span class="token function">listen</span><span class="token punctuation">(</span>QHostAddress<span class="token operator">::</span>Any<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setWindowTitle</span><span class="token punctuation">(</span><span class="token string">"服务器："</span><span class="token operator">+</span>ui<span class="token operator">-</span><span class="token operator">></span>lineEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>textEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"聊天室创建成功！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//如果新进客户端与服务器连接，tcpServer会自动触发newConnection()</span>
    <span class="token function">connect</span><span class="token punctuation">(</span>tcpserver<span class="token punctuation">,</span><span class="token operator">&amp;</span>QTcpServer<span class="token operator">::</span>newConnection<span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                     count<span class="token operator">++</span><span class="token punctuation">;</span>
                     ui<span class="token operator">-</span><span class="token operator">></span>labelonline<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"当前在线人数："</span><span class="token operator">+</span>QString<span class="token operator">::</span><span class="token function">number</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token comment" spellcheck="true">//取出socket</span>
                     QTcpSocket <span class="token operator">*</span>socket<span class="token punctuation">;</span>
                     socket <span class="token operator">=</span> tcpserver<span class="token operator">-</span><span class="token operator">></span><span class="token function">nextPendingConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token comment" spellcheck="true">//加入数组</span>
                     socketarr<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>

                     QString ip <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出ip</span>


                     ip <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//删除前缀</span>
                     qint16 port <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出端口</span>

                     <span class="token comment" spellcheck="true">/***********************************加入新的用户**************************************/</span>
                     people per<span class="token punctuation">;</span>
                     per<span class="token punctuation">.</span>pip <span class="token operator">=</span> ip<span class="token punctuation">;</span>
                     per<span class="token punctuation">.</span>pport <span class="token operator">=</span> port<span class="token punctuation">;</span>
                     per<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"NULL"</span><span class="token punctuation">;</span>
                     plist<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token comment" spellcheck="true">/***********************************************************************************/</span>

                     <span class="token comment" spellcheck="true">//组包提示信息</span>
                     QString temp <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"[%1%2]:进入聊天室"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     ui<span class="token operator">-</span><span class="token operator">></span>textEdit_online<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//增加显示当前所有的用户ip</span>
                     ui<span class="token operator">-</span><span class="token operator">></span>textEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                     temp <span class="token operator">=</span> MSG_flag<span class="token operator">+</span>temp<span class="token punctuation">;</span>
                     <span class="token comment" spellcheck="true">//广播新进用户</span>
                     <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                         socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token punctuation">}</span>



                     <span class="token function">connect</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span><span class="token operator">&amp;</span>QTcpSocket<span class="token operator">::</span>readyRead<span class="token punctuation">,</span>
                             <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                <span class="token punctuation">{</span>
                                    <span class="token comment" spellcheck="true">//取内容</span>
                                    QByteArray byteBuf <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    QString buf <span class="token operator">=</span>byteBuf<span class="token punctuation">;</span>
                                    <span class="token keyword">if</span><span class="token punctuation">(</span>readyFile<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//接收文件信息</span>
                                    <span class="token punctuation">{</span>
                                        qint64 len <span class="token operator">=</span> file2<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        recvSize2 <span class="token operator">+</span><span class="token operator">=</span> len<span class="token punctuation">;</span>
                                        <span class="token keyword">if</span><span class="token punctuation">(</span>recvSize2 <span class="token operator">==</span> fileSize2<span class="token punctuation">)</span>
                                        <span class="token punctuation">{</span>
                                           QString str <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"收到文件：[%1: %2KB]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileName2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileSize2<span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                           file2<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                           QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"文件信息"</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                           recvSize2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                                           readyFile <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span>
                                        <span class="token keyword">return</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                    <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>people_new<span class="token punctuation">)</span>
                                    <span class="token punctuation">{</span>
                                        <span class="token comment" spellcheck="true">//取出ip</span>
                                        QString ip <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出ip</span>
                                        <span class="token comment" spellcheck="true">//删除前缀</span>
                                        ip <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        qint16 port1 <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出端口</span>

                                        QString thename<span class="token punctuation">;</span>
                                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                             thename<span class="token punctuation">[</span>j<span class="token number">-1</span><span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span>

                                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>plist<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                            <span class="token keyword">if</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pip<span class="token operator">==</span>ip <span class="token operator">&amp;&amp;</span> plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pport <span class="token operator">==</span> port1<span class="token punctuation">)</span><span class="token punctuation">{</span>
                                                plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> thename<span class="token punctuation">;</span>
                                                                                     <span class="token comment" spellcheck="true">/**发给客户端*/</span>
                                                QString thestring<span class="token punctuation">;</span>

                                                thestring <span class="token operator">=</span> to_c_people_new <span class="token operator">+</span> plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pip <span class="token operator">+</span>sys_flag<span class="token operator">+</span> QString<span class="token operator">::</span><span class="token function">number</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pport<span class="token punctuation">)</span> <span class="token operator">+</span> sys_flag <span class="token operator">+</span> plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
                                                <span class="token comment" spellcheck="true">//P  ip  ! port ! name</span>

                                                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                                    socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>thestring<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                <span class="token punctuation">}</span>
                                                <span class="token keyword">return</span><span class="token punctuation">;</span>
                                            <span class="token punctuation">}</span>
                                        <span class="token punctuation">}</span>
                                    <span class="token punctuation">}</span>
                                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> sys_flag<span class="token punctuation">)</span>
                                    <span class="token punctuation">{</span>
                                        <span class="token comment" spellcheck="true">//信息：</span>
                                        buf <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//去掉sys_flag</span>
                                        QString ip <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出ip</span>
                                        qint16 port <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出端口号</span>
                                        ip <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//删除ip前缀</span>


                                        <span class="token comment" spellcheck="true">//文件反馈信息</span>
                                        <span class="token keyword">if</span><span class="token punctuation">(</span>buf <span class="token operator">==</span> <span class="token string">"filedone"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                           QString thetemp <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span>ip<span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span><span class="token string">"文件已接收"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                           ui<span class="token operator">-</span><span class="token operator">></span>textEditFile<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>thetemp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span>
                                        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf <span class="token operator">==</span> <span class="token string">"Close"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//接收到用户端退出产生的反馈</span>
                                        <span class="token punctuation">{</span>

                                            <span class="token comment" spellcheck="true">/*******************************************************************************/</span>
                                            <span class="token comment" spellcheck="true">/********************************用户离开****************************************/</span>
                                            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>plist<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                                <span class="token keyword">if</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pip<span class="token operator">==</span>ip <span class="token operator">&amp;&amp;</span> plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pport <span class="token operator">==</span> port<span class="token punctuation">)</span><span class="token punctuation">{</span>
                                                     <span class="token comment" spellcheck="true">/*发给客户端*/</span>
                                                     QString str<span class="token punctuation">;</span>
                                                     str <span class="token operator">=</span> to_c_people_del <span class="token operator">+</span> plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pip <span class="token operator">+</span><span class="token string">"!"</span> <span class="token operator">+</span> QString<span class="token operator">::</span><span class="token function">number</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pport<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                     <span class="token comment" spellcheck="true">//P  ip ! port</span>

                                                     <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                                         socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                     <span class="token punctuation">}</span>

                                                     plist<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                     <span class="token keyword">break</span><span class="token punctuation">;</span>
                                                <span class="token punctuation">}</span>
                                            <span class="token punctuation">}</span>
                                            <span class="token comment" spellcheck="true">/********************************************************************************/</span>

                                            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                                <span class="token keyword">int</span> iplen <span class="token operator">=</span> socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">;</span>
                                                <span class="token keyword">if</span><span class="token punctuation">(</span>socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>iplen<span class="token punctuation">)</span><span class="token operator">==</span>ip<span class="token punctuation">)</span><span class="token punctuation">{</span>
                                                    QString temp <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"[%1%2]:离开聊天室"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    ui<span class="token operator">-</span><span class="token operator">></span>textEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    temp <span class="token operator">=</span> <span class="token string">"MSG##"</span><span class="token operator">+</span>temp<span class="token punctuation">;</span>
                                                    <span class="token comment" spellcheck="true">//广播出去</span>
                                                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                                       socketarr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    <span class="token punctuation">}</span>
                                                    <span class="token comment" spellcheck="true">//删除</span>
                                                    socketarr<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    count<span class="token operator">--</span><span class="token punctuation">;</span>
                                                    ui<span class="token operator">-</span><span class="token operator">></span>labelonline<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"当前在线人数："</span><span class="token operator">+</span>QString<span class="token operator">::</span><span class="token function">number</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                                               <span class="token punctuation">}</span>
                                            <span class="token punctuation">}</span>


                                            <span class="token comment" spellcheck="true">//在存在用户退出后，更新显示当前在线用户端ip</span>
                                            <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
                                            <span class="token punctuation">{</span>
                                               ui<span class="token operator">-</span><span class="token operator">></span>textEdit_online<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                            <span class="token punctuation">}</span>
                                            <span class="token keyword">else</span>
                                            <span class="token punctuation">{</span>
                                                <span class="token comment" spellcheck="true">//显示首ip</span>
                                                QString ip <span class="token operator">=</span> socketarr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出ip</span>
                                                <span class="token comment" spellcheck="true">//删除前缀！</span>
                                                ip <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                ui<span class="token operator">-</span><span class="token operator">></span>textEdit_online<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>


                                                <span class="token comment" spellcheck="true">//显示剩余ip</span>
                                                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
                                                <span class="token punctuation">{</span>
                                                QString ip <span class="token operator">=</span> socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出ip</span>
                                                <span class="token comment" spellcheck="true">//删除前缀！</span>
                                                ip <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                ui<span class="token operator">-</span><span class="token operator">></span>textEdit_online<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                <span class="token punctuation">}</span>
                                            <span class="token punctuation">}</span>
                                       <span class="token punctuation">}</span>
                                    <span class="token punctuation">}</span>
                                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">left</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> MSG_flag<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">//文本信息广播出去</span>
                                    <span class="token punctuation">{</span>
                                        QString temp1 <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        ui<span class="token operator">-</span><span class="token operator">></span>textEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>temp1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                            socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>temp1<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span>
                                    <span class="token punctuation">}</span>
                                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> head_flag<span class="token punctuation">)</span>
                                    <span class="token punctuation">{</span>
                                        fileName2 <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">"##"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        fileSize2 <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">"##"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        file2<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span><span class="token string">"../files/"</span><span class="token operator">+</span>fileName2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token keyword">bool</span> isOk <span class="token operator">=</span> file2<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span> QFile<span class="token operator">::</span>WriteOnly<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        ui<span class="token operator">-</span><span class="token operator">></span>textEditFile<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"收到文件："</span> <span class="token operator">+</span> file2<span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> isOk<span class="token punctuation">)</span>
                                        <span class="token punctuation">{</span>
                                            QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"文件信息"</span><span class="token punctuation">,</span><span class="token string">"服务器炸了QWQ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                            <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span>
                                        readyFile <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                                    <span class="token punctuation">}</span> 
                                <span class="token punctuation">}</span>
                             <span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**************************************************************************************/</span>
    <span class="token comment" spellcheck="true">//监听socket</span>
    phonetcpserver <span class="token operator">=</span> <span class="token keyword">new</span> QTcpServer<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//receive</span>
    <span class="token comment" spellcheck="true">//qint16 phoneport = ui->lineEditphone->text().toInt();</span>
    phonetcpserver<span class="token operator">-</span><span class="token operator">></span><span class="token function">listen</span><span class="token punctuation">(</span>QHostAddress<span class="token operator">::</span>Any<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>ui<span class="token operator">-</span><span class="token operator">></span>lineEditphone<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">connect</span><span class="token punctuation">(</span>phonetcpserver<span class="token punctuation">,</span><span class="token operator">&amp;</span>QTcpServer<span class="token operator">::</span>newConnection<span class="token punctuation">,</span>
           <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
                QTcpSocket <span class="token operator">*</span> thesocket<span class="token punctuation">;</span>
                thesocket <span class="token operator">=</span> phonetcpserver<span class="token operator">-</span><span class="token operator">></span><span class="token function">nextPendingConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出socket</span>
                QString ip <span class="token operator">=</span> thesocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> port <span class="token operator">=</span> thesocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ip <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ui<span class="token operator">-</span><span class="token operator">></span>textEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"%1::%2-进入语音聊天室"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment" spellcheck="true">//connect 一定要写在newConnection内</span>
                <span class="token function">connect</span><span class="token punctuation">(</span>thesocket<span class="token punctuation">,</span><span class="token function">SIGNAL</span><span class="token punctuation">(</span><span class="token function">readyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">SLOT</span><span class="token punctuation">(</span><span class="token function">readyReadSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//receiv  important</span>
                phonetcpsocket<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>thesocket<span class="token punctuation">)</span><span class="token punctuation">;</span>
                phone_count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



    QAudioFormat format<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//采样设置</span>
    format<span class="token punctuation">.</span><span class="token function">setCodec</span><span class="token punctuation">(</span><span class="token string">"audio/pcm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//编码</span>
    format<span class="token punctuation">.</span><span class="token function">setByteOrder</span><span class="token punctuation">(</span>QAudioFormat<span class="token operator">::</span>LittleEndian<span class="token punctuation">)</span><span class="token punctuation">;</span>
    format<span class="token punctuation">.</span><span class="token function">setSampleRate</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//采样评率</span>
    format<span class="token punctuation">.</span><span class="token function">setSampleSize</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//采样点数据位数</span>
    format<span class="token punctuation">.</span><span class="token function">setSampleType</span><span class="token punctuation">(</span>QAudioFormat<span class="token operator">::</span>UnSignedInt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//返回采样点格式</span>
    format<span class="token punctuation">.</span><span class="token function">setChannelCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//音频数据通道数</span>

    input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QAudioInput</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//采用格式</span>
    inputDevice <span class="token operator">=</span> input<span class="token operator">-</span><span class="token operator">></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//采集声音</span>


    output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QAudioOutput</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    outputDevice <span class="token operator">=</span> output<span class="token operator">-</span><span class="token operator">></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//开始播放</span>
    <span class="token function">connect</span><span class="token punctuation">(</span>inputDevice<span class="token punctuation">,</span><span class="token function">SIGNAL</span><span class="token punctuation">(</span><span class="token function">readyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">SLOT</span><span class="token punctuation">(</span><span class="token function">onReadyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/**************************************************************************************/</span>


<span class="token punctuation">}</span>



<span class="token comment" spellcheck="true">//选择文件按钮</span>
<span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">on_ButtonSelect_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    QString fPath <span class="token operator">=</span> QFileDialog<span class="token operator">::</span><span class="token function">getOpenFileName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"open"</span><span class="token punctuation">,</span><span class="token string">"../"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> fPath<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//如果选择文件路径有效</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//初始化</span>
        fileName<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//        sendSize = 0;</span>
        filePath <span class="token operator">=</span> fPath<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//获取文件信息</span>
        QFileInfo <span class="token function">info</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileName <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileSize <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"选择文件路径出错 62"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">on_ButtonSend_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"on_ButtonSend_clicked"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//先发送文件头信息 文件名##文件大小</span>
    QString subhead <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"%1##%2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QString head <span class="token operator">=</span> head_flag <span class="token operator">+</span> subhead<span class="token punctuation">;</span>


    <span class="token comment" spellcheck="true">//(广播)发送头部信息</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        qint64 len <span class="token operator">=</span> socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>head<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//头部信息发送成功</span>
        <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//发送真正的文件信息</span>
            <span class="token comment" spellcheck="true">//防止TCP黏包，需要通过定时器延时20ms</span>
            <span class="token comment" spellcheck="true">//文件传输计时器</span>
            <span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>QTimer<span class="token operator">::</span>timeout<span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token comment" spellcheck="true">//关闭定时器</span>
                        timer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment" spellcheck="true">//发送文件</span>
                        <span class="token function">sendData</span><span class="token punctuation">(</span>socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                   <span class="token punctuation">)</span><span class="token punctuation">;</span>
            timer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"头部信息发送失败 110"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>



<span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">sendData</span><span class="token punctuation">(</span>QTcpSocket<span class="token operator">*</span> tcpSocket<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">//指定文件名</span>
    file<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//打开文件</span>
    <span class="token keyword">bool</span> isOk <span class="token operator">=</span> file<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token operator">::</span>ReadOnly<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> isOk<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"只读方式打开文件失败 77"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">//提示打开文件的路径</span>
    ui<span class="token operator">-</span><span class="token operator">></span>textEditFile<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> fileSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    qint64 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">do</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//每次发送数据的单位（缓冲区大小）</span>
        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//往文件中读数据</span>
        len <span class="token operator">=</span> file<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//发送数据</span>
        len <span class="token operator">=</span> tcpSocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//发送的数据需要累积</span>
        sendSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> len<span class="token punctuation">;</span>
        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setValue</span><span class="token punctuation">(</span>sendSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//判断是否发送文件完毕</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>sendSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> fileSize<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        sendSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//以免重复弹出完成提示</span>
        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        file<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span>count<span class="token number">-1</span><span class="token punctuation">)</span>
        QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"文件信息"</span><span class="token punctuation">,</span><span class="token string">"文件传输完毕"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/***********************************************************/</span>
<span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">onReadyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"onReadyRead"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/*----------------------------------send************************/</span>
        video vp<span class="token punctuation">;</span>
        <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>vp<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>vp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//读取音频</span>
<span class="token comment" spellcheck="true">//        vp.lens = inputDevice->read(vp.audiodata,1024);//读取音频</span>

<span class="token comment" spellcheck="true">//        for(int j=0;j&lt;phone_count;j++){</span>
<span class="token comment" spellcheck="true">//            phonetcpsocket[j]->write((const char*)&amp;vp,sizeof(vp));</span>
<span class="token comment" spellcheck="true">//        }</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">readyReadSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"read"</span> <span class="token punctuation">;</span>
        <span class="token keyword">int</span> size <span class="token operator">=</span> output<span class="token operator">-</span><span class="token operator">></span><span class="token function">periodSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        QByteArray bug<span class="token punctuation">;</span>

        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"audio is being received..."</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>


        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>k<span class="token operator">&lt;</span>phone_count<span class="token punctuation">;</span>k<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            bug <span class="token operator">=</span> phonetcpsocket<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>bug<span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>phone_count<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">==</span> j<span class="token punctuation">)</span>  <span class="token keyword">continue</span><span class="token punctuation">;</span>
                phonetcpsocket<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>bug<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<h6 id="main-cpp"><a href="#main-cpp" class="headerlink" title="main.cpp"></a>main.cpp</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"serverwidget.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QApplication></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QStyleFactory></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFile></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    QApplication <span class="token function">a</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    a<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>QStyleFactory<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"Fusion"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ServerWidget w<span class="token punctuation">;</span>
    w<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h5 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端"></a>客户端</h5><p>注：pro文件添加</p>
<p><code>QT       += core gui network multimedia</code></p>
<h6 id="item-h"><a href="#item-h" class="headerlink" title="item.h"></a>item.h</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">ifndef</span> ITEM_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ITEM_H</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QString></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QPushButton></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QWidget></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QHBoxLayout></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTextEdit></span></span>
<span class="token keyword">class</span> <span class="token class-name">ITEM</span>
<span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    QTextEdit <span class="token operator">*</span>msgbtn<span class="token punctuation">;</span>
    QPushButton <span class="token operator">*</span>imgbtn<span class="token punctuation">;</span>
    QWidget <span class="token operator">*</span>itw<span class="token punctuation">;</span>
    QHBoxLayout <span class="token operator">*</span>hlayout<span class="token punctuation">;</span>
    QString name<span class="token punctuation">;</span>
    QString color<span class="token punctuation">;</span>
    QString align<span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">fheight</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">fwidth</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">ITEM</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>name<span class="token punctuation">,</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>ali <span class="token punctuation">,</span> QWidget <span class="token operator">*</span>w<span class="token punctuation">,</span> QFont <span class="token operator">*</span>f<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token keyword">bool</span> vis<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setStyle</span><span class="token punctuation">(</span>QFont <span class="token operator">*</span>f<span class="token punctuation">,</span> <span class="token keyword">double</span> r<span class="token punctuation">,</span> <span class="token keyword">double</span> w<span class="token punctuation">,</span> <span class="token keyword">double</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QWidget<span class="token operator">*</span> <span class="token function">Item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment" spellcheck="true">// ITEM_H</span></code></pre>
<h6 id="item-cpp"><a href="#item-cpp" class="headerlink" title="item.cpp"></a>item.cpp</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"item.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QVBoxLayout></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cmath></span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">int</span> ITEM<span class="token operator">::</span><span class="token function">fwidth</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    QFont f <span class="token operator">=</span> msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QFontMetrics <span class="token function">fm</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QStringList sl <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ma<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> s<span class="token operator">:</span>sl<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ma <span class="token operator">&lt;</span> fm<span class="token punctuation">.</span><span class="token function">boundingRect</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            ma <span class="token operator">=</span> fm<span class="token punctuation">.</span><span class="token function">boundingRect</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">min</span><span class="token punctuation">(</span>ma<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token operator">*</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> ITEM<span class="token operator">::</span><span class="token function">fheight</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    QFont f <span class="token operator">=</span> msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QFontMetrics <span class="token function">fm</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QStringList sl <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> res<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> h <span class="token operator">=</span> fm<span class="token punctuation">.</span><span class="token function">boundingRect</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> s<span class="token operator">:</span>sl<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        res <span class="token operator">+</span><span class="token operator">=</span> h<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>fm<span class="token punctuation">.</span><span class="token function">boundingRect</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">20</span> <span class="token operator">></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token operator">*</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            res <span class="token operator">+</span><span class="token operator">=</span> fm<span class="token punctuation">.</span><span class="token function">boundingRect</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token operator">*</span>w<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">*</span> h<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">max</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

ITEM<span class="token operator">::</span><span class="token function">ITEM</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>ali<span class="token punctuation">,</span> QWidget <span class="token operator">*</span>W<span class="token punctuation">,</span>
           QFont <span class="token operator">*</span>f<span class="token punctuation">,</span> <span class="token keyword">bool</span> vis<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    align <span class="token operator">=</span> ali<span class="token punctuation">;</span>
    itw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QWidget</span><span class="token punctuation">(</span>W<span class="token punctuation">)</span><span class="token punctuation">;</span>
    hlayout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QHBoxLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    itw<span class="token operator">-</span><span class="token operator">></span><span class="token function">setLayout</span><span class="token punctuation">(</span>hlayout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QString btnMsg<span class="token operator">=</span><span class="token string">"  "</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> l<span class="token operator">=</span>msg<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>l<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            btnMsg<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"\n  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            btnMsg<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    btnMsg<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    msgbtn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QTextEdit</span><span class="token punctuation">(</span>itw<span class="token punctuation">)</span><span class="token punctuation">;</span>
    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span>btnMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setReadOnly</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    imgbtn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QPushButton</span><span class="token punctuation">(</span>itw<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>align <span class="token operator">==</span> <span class="token string">"left"</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addWidget</span><span class="token punctuation">(</span>imgbtn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addWidget</span><span class="token punctuation">(</span>msgbtn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addStretch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addStretch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addWidget</span><span class="token punctuation">(</span>msgbtn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addWidget</span><span class="token punctuation">(</span>imgbtn<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    imgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        f<span class="token operator">-</span><span class="token operator">></span><span class="token function">setFamily</span><span class="token punctuation">(</span><span class="token string">"微软雅黑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        f<span class="token operator">-</span><span class="token operator">></span><span class="token function">setPixelSize</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setFont</span><span class="token punctuation">(</span><span class="token operator">*</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QString alpha <span class="token operator">=</span> <span class="token string">"255"</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>vis<span class="token punctuation">)</span>    alpha<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"刘朝日"</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">=</span> <span class="token string">"lzr.png"</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>color <span class="token operator">=</span> <span class="token string">"rgba(169,209,142,"</span><span class="token operator">+</span>alpha<span class="token operator">+</span><span class="token string">");"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"刘硕"</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">=</span> <span class="token string">"ls.png"</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>color <span class="token operator">=</span> <span class="token string">"rgba(255,217,102,"</span><span class="token operator">+</span>alpha<span class="token operator">+</span><span class="token string">");"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"曹文豪"</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">=</span> <span class="token string">"cwh.png"</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>color <span class="token operator">=</span> <span class="token string">"rgba(157,195,230,"</span><span class="token operator">+</span>alpha<span class="token operator">+</span><span class="token string">");"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"刘涵准"</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">=</span> <span class="token string">"lhz.png"</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>color <span class="token operator">=</span> <span class="token string">"rgba(102,204,255,"</span><span class="token operator">+</span>alpha<span class="token operator">+</span><span class="token string">");"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"雷艳"</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">=</span> <span class="token string">"ly.png"</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>color <span class="token operator">=</span> <span class="token string">"rgba(252,209,216,"</span><span class="token operator">+</span>alpha<span class="token operator">+</span><span class="token string">");"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    imgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setFixedSize</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    imgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"border-image:url(../src/"</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">+</span><span class="token string">");"</span>
                          <span class="token string">"border-radius:30px;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color:"</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>color <span class="token operator">+</span>
                          <span class="token string">"border-radius: 5px;"</span>
                          <span class="token punctuation">)</span><span class="token punctuation">;</span>
    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setMinimumHeight</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">setMargin</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ITEM<span class="token operator">::</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setFixedSize</span><span class="token punctuation">(</span><span class="token function">fwidth</span><span class="token punctuation">(</span>msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toPlainText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span>
                         <span class="token function">fheight</span><span class="token punctuation">(</span>msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toPlainText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    itw<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">1.3</span><span class="token operator">*</span>imgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">1.3</span><span class="token operator">*</span>msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> ITEM<span class="token operator">::</span><span class="token function">setMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>msg<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

QWidget<span class="token operator">*</span> ITEM<span class="token operator">::</span><span class="token function">Item</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> itw<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h6 id="clientwidget-h"><a href="#clientwidget-h" class="headerlink" title="clientwidget.h"></a>clientwidget.h</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">ifndef</span> CLIENTWIDGET_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> CLIENTWIDGET_H</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QWidget></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTcpSocket></span></span>

<span class="token comment" spellcheck="true">//音频信息</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QDialog></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QtNetwork/QUdpSocket></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudio></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudioInput></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudioOutput></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QIODevice></span></span>


<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFile></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QDebug></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QMessageBox></span></span><span class="token comment" spellcheck="true">//弹出对话框</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QPushButton></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTextEdit></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QVector></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QVBoxLayout></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTimer></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"item.h"</span></span>
QT_BEGIN_NAMESPACE
<span class="token keyword">namespace</span> Ui <span class="token punctuation">{</span> <span class="token keyword">class</span> <span class="token class-name">ClientWidget</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
QT_END_NAMESPACE


<span class="token keyword">const</span> <span class="token keyword">char</span> file_flag <span class="token operator">=</span> <span class="token string">'F'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> head_flag <span class="token operator">=</span> <span class="token string">'H'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> QString MSG_flag <span class="token operator">=</span> <span class="token string">"MSG##"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> sys_flag <span class="token operator">=</span> <span class="token string">'!'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> people_new <span class="token operator">=</span> <span class="token string">'P'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//新的用户到来</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> people_del <span class="token operator">=</span> <span class="token string">'D'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//新的用户离开</span>
<span class="token comment" spellcheck="true">/***********************************************/</span>
<span class="token keyword">struct</span> people<span class="token punctuation">{</span>
    QString pip<span class="token punctuation">;</span>
    QString name<span class="token punctuation">;</span>
    QString pport<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">/***********************************************/</span>






<span class="token keyword">class</span> <span class="token class-name">ClientWidget</span> <span class="token operator">:</span> <span class="token keyword">public</span> QWidget
<span class="token punctuation">{</span>
    Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">ClientWidget</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">ClientWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">on_pushButtonenter_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> slots<span class="token operator">:</span>


    <span class="token keyword">void</span> <span class="token function">on_pushButtonsend_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">on_pushButtonclose_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">on_selectButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">on_sendButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">slider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">readyReadSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">onReadyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    Ui<span class="token operator">::</span>ClientWidget <span class="token operator">*</span>ui<span class="token punctuation">;</span>
    QVBoxLayout <span class="token operator">*</span>vlayout<span class="token punctuation">;</span>
    QWidget <span class="token operator">*</span>login<span class="token punctuation">;</span>
    QWidget <span class="token operator">*</span>upload<span class="token punctuation">;</span>
    QString name<span class="token punctuation">,</span> ip<span class="token punctuation">;</span>
    <span class="token keyword">int</span> port<span class="token punctuation">;</span>
    QVector<span class="token operator">&lt;</span>ITEM <span class="token operator">*</span><span class="token operator">></span> items<span class="token punctuation">;</span>
    <span class="token keyword">int</span> phone_port<span class="token punctuation">;</span>
    QVector<span class="token operator">&lt;</span>people<span class="token operator">></span> plist<span class="token punctuation">;</span>

    QTcpSocket <span class="token operator">*</span>tcpsocket<span class="token punctuation">;</span>
    QFile  file<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件对象</span>
    QString fileName<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件名字</span>
    qint64 fileSize<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件大小</span>
    qint64 recvSize<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//已接收的文件大小</span>


    <span class="token comment" spellcheck="true">//客户端作为发送端</span>
    QFile  file2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件对象</span>
    QString fileName2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件名字</span>
    qint64 fileSize2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件大小</span>
    qint64 sendSize2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//已发送的文件大小</span>

    QTimer timer<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//定时器  黏包  头部----文件体</span>
    QMessageBox msgBox<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> phone_on<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> fileflag<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> readyFile<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">pushMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>alig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">updateList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//音频</span>
    QTcpSocket <span class="token operator">*</span>phone_tcpsocket<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//out</span>
    QAudioOutput <span class="token operator">*</span>output<span class="token punctuation">;</span>
    QIODevice <span class="token operator">*</span>outputDevice<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//in</span>
    QAudioInput <span class="token operator">*</span>input<span class="token punctuation">;</span>
    QIODevice <span class="token operator">*</span>inputDevice<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> linktophone<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>


<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">sendData</span><span class="token punctuation">(</span>QTcpSocket<span class="token operator">*</span> tcpSocket<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//发送文件数据</span>
    <span class="token keyword">void</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>

signals<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">logined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> video<span class="token punctuation">{</span>
        <span class="token keyword">char</span> audiodata<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> lens<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment" spellcheck="true">// CLIENTWIDGET_H</span>
</code></pre>
<h6 id="clientwidget-cpp"><a href="#clientwidget-cpp" class="headerlink" title="clientwidget.cpp"></a>clientwidget.cpp</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clientwidget.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ui_clientwidget.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QHostAddress></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFileDialog></span></span><span class="token comment" spellcheck="true">//选择文件的对话框</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QPainter></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QInputDialog></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QWidget></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QScrollArea></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFont></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QPushButton></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTextEdit></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAbstractSlider></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QScrollBar></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QLineEdit></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QDebug></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QProgressBar></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QRect></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"item.h"</span></span>
ClientWidget<span class="token operator">::</span><span class="token function">ClientWidget</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">QWidget</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token function">ui</span><span class="token punctuation">(</span><span class="token keyword">new</span> Ui<span class="token operator">::</span>ClientWidget<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    phone_tcpsocket <span class="token operator">=</span> <span class="token keyword">new</span> QTcpSocket<span class="token punctuation">;</span>
    ip<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
    port <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span><span class="token function">setupUi</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>sendButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    readyFile <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    phone_on <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token function">setWindowTitle</span><span class="token punctuation">(</span><span class="token string">"计算机网络点点通信实验"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">1350</span><span class="token punctuation">,</span> <span class="token number">850</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tcpsocket <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    tcpsocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QTcpSocket</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ClientWidget<span class="token operator">::</span>close<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ClientWidget<span class="token operator">::</span>on_pushButtonclose_clicked<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>scrollArea<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color:rgba(255,255,255,0)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>input<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color:rgba(255,255,0,20);"</span>
                             <span class="token string">"border-style:solid;"</span>
                             <span class="token string">"border-radius:5px;"</span>
                             <span class="token string">"border-color:yellow;"</span>
                             <span class="token string">"border-width:2.5px;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QFont f<span class="token punctuation">;</span>
    f<span class="token punctuation">.</span><span class="token function">setFamily</span><span class="token punctuation">(</span><span class="token string">"微软雅黑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    f<span class="token punctuation">.</span><span class="token function">setPixelSize</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>input<span class="token operator">-</span><span class="token operator">></span><span class="token function">setFont</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vlayout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QVBoxLayout</span><span class="token punctuation">(</span>ui<span class="token operator">-</span><span class="token operator">></span>scrollAreaWidgetContents<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>scrollAreaWidgetContents<span class="token operator">-</span><span class="token operator">></span><span class="token function">setLayout</span><span class="token punctuation">(</span>vlayout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">setDirection</span><span class="token punctuation">(</span>QBoxLayout<span class="token operator">::</span>BottomToTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addStretch</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">connect</span><span class="token punctuation">(</span>ui<span class="token operator">-</span><span class="token operator">></span>scrollArea<span class="token operator">-</span><span class="token operator">></span><span class="token function">verticalScrollBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>QAbstractSlider<span class="token operator">::</span>rangeChanged<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ClientWidget<span class="token operator">::</span>slider<span class="token punctuation">)</span><span class="token punctuation">;</span>

    upload <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    login <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    login<span class="token operator">-</span><span class="token operator">></span><span class="token function">setWindowTitle</span><span class="token punctuation">(</span><span class="token string">"SOCKET 通信"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    login<span class="token operator">-</span><span class="token operator">></span><span class="token function">setFixedSize</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    QPushButton <span class="token operator">*</span>namelabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QPushButton</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>
    namelabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"用户名"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    namelabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QLineEdit <span class="token operator">*</span>name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLineEdit</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>
    name<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    QPushButton <span class="token operator">*</span>iplabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QPushButton</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iplabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"ip地址"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iplabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QLineEdit <span class="token operator">*</span>ip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLineEdit</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ip<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    QPushButton <span class="token operator">*</span>portlabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QPushButton</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>
    portlabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"port"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    portlabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QLineEdit <span class="token operator">*</span>port <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLineEdit</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>
    port<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    QPushButton <span class="token operator">*</span>phoneportlabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QPushButton</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>
    phoneportlabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"p_port"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    phoneportlabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QLineEdit <span class="token operator">*</span>phoneport <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLineEdit</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>
    phoneport<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    phoneport<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"10085"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    QPushButton <span class="token operator">*</span>loginbtn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QPushButton</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>
    loginbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    loginbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">270</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



    login<span class="token operator">-</span><span class="token operator">></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">connect</span><span class="token punctuation">(</span>loginbtn<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QPushButton<span class="token operator">::</span>pressed<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">,</span> ip<span class="token punctuation">,</span> port<span class="token punctuation">,</span> name<span class="token punctuation">,</span> phoneport<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">=</span> name<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>ip <span class="token operator">=</span> ip<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>port <span class="token operator">=</span> port<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>phone_port <span class="token operator">=</span> phoneport<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">!=</span> <span class="token string">"刘朝日"</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">!=</span> <span class="token string">"曹文豪"</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">!=</span> <span class="token string">"刘硕"</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">!=</span> <span class="token string">"刘涵准"</span>
                <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">!=</span> <span class="token string">"雷艳"</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">on_pushButtonenter_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ClientWidget<span class="token operator">::</span>logined<span class="token punctuation">,</span> login<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QWidget<span class="token operator">::</span>close<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setMinimumSize</span><span class="token punctuation">(</span><span class="token number">810</span><span class="token punctuation">,</span> <span class="token number">510</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setMaximumSize</span><span class="token punctuation">(</span><span class="token number">1350</span><span class="token punctuation">,</span> <span class="token number">850</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>onlineListW<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color:rgba(197,232,211,125);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ui<span class="token operator">-</span><span class="token operator">></span>selectButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"QPushButton{border-image:url(../src/upload.png);"</span>
                                    <span class="token string">"border-radius:40px;}"</span>
                                    <span class="token string">"QPushButton:hover{border-image:url(../src/upload_hover.png);"</span>
                                    <span class="token string">"border-radius:40px;}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>phoneButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"QPushButton{border-image:url(../src/phone_off.png);"</span>
                                     <span class="token string">"border-radius:40px;}"</span>
                                   <span class="token string">"QPushButton:hover{border-image:url(../src/phone_hover.png);"</span>
                                   <span class="token string">"border-radius:40px;}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">connect</span><span class="token punctuation">(</span>ui<span class="token operator">-</span><span class="token operator">></span>phoneButton<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QPushButton<span class="token operator">::</span>pressed<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>phone_on<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            ui<span class="token operator">-</span><span class="token operator">></span>phoneButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"QPushButton{border-image:url(../src/phone_off.png);"</span>
                                             <span class="token string">"border-radius:40px;}"</span>
                                           <span class="token string">"QPushButton:hover{border-image:url(../src/phone_hover.png);"</span>
                                           <span class="token string">"border-radius:40px;}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            phone_tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//获取服务器的ip和端口</span>
            <span class="token comment" spellcheck="true">//主动和服务器连接</span>
            phone_tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">connectToHost</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>ip<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>phone_port<span class="token punctuation">)</span><span class="token punctuation">;</span>

            ui<span class="token operator">-</span><span class="token operator">></span>phoneButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"QPushButton{border-image:url(../src/phone_on.png);"</span>
                                             <span class="token string">"border-radius:40px;}"</span>
                                           <span class="token string">"QPushButton:hover{border-image:url(../src/phone_onhover.png);"</span>
                                           <span class="token string">"border-radius:40px;}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        phone_on <span class="token operator">=</span> <span class="token operator">!</span>phone_on<span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment" spellcheck="true">//音频信息</span><span class="token comment" spellcheck="true">/*****************************************************************/</span>


        <span class="token function">connect</span><span class="token punctuation">(</span>phone_tcpsocket<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QTcpSocket<span class="token operator">::</span>connected<span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//提示连接成功</span>
<span class="token comment" spellcheck="true">//            ui->textEdit->append("已经加入语音群聊");</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">connect</span><span class="token punctuation">(</span>phone_tcpsocket<span class="token punctuation">,</span><span class="token function">SIGNAL</span><span class="token punctuation">(</span><span class="token function">readyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">SLOT</span><span class="token punctuation">(</span><span class="token function">readyReadSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//设置参数</span>
        QAudioFormat format<span class="token punctuation">;</span>
        format<span class="token punctuation">.</span><span class="token function">setSampleRate</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        format<span class="token punctuation">.</span><span class="token function">setChannelCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        format<span class="token punctuation">.</span><span class="token function">setSampleSize</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        format<span class="token punctuation">.</span><span class="token function">setCodec</span><span class="token punctuation">(</span><span class="token string">"audio/pcm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        format<span class="token punctuation">.</span><span class="token function">setSampleType</span><span class="token punctuation">(</span>QAudioFormat<span class="token operator">::</span>SignedInt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        format<span class="token punctuation">.</span><span class="token function">setByteOrder</span><span class="token punctuation">(</span>QAudioFormat<span class="token operator">::</span>LittleEndian<span class="token punctuation">)</span><span class="token punctuation">;</span>

        output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QAudioOutput</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        outputDevice <span class="token operator">=</span> output<span class="token operator">-</span><span class="token operator">></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//开始播放</span>

        input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QAudioInput</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        inputDevice <span class="token operator">=</span> input<span class="token operator">-</span><span class="token operator">></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">connect</span><span class="token punctuation">(</span>inputDevice<span class="token punctuation">,</span><span class="token function">SIGNAL</span><span class="token punctuation">(</span><span class="token function">readyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">SLOT</span><span class="token punctuation">(</span><span class="token function">onReadyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//send</span>

        <span class="token comment" spellcheck="true">//音频信息</span><span class="token comment" spellcheck="true">/*****************************************************************/</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    QPainter <span class="token function">p</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token punctuation">.</span><span class="token function">drawPixmap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">QPixmap</span><span class="token punctuation">(</span><span class="token string">"../src/background.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>scrollArea<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.75</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.87</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>scrollArea<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.25</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>input<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.585</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.09</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>input<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.25</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.90</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>pushButtonsend<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.85</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.90</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>pushButtonsend<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.14</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.04</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>pushButtonclose<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.85</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>pushButtonclose<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.14</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.04</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>scrollAreaWidgetContents<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.75</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.87</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>onlineListW<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.25</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.87</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>onlineListW<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>selectButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.09</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.09</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>phoneButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.09</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0.09</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>selectButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.03</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.90</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>phoneButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.18</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token number">0.90</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">slider</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    ui<span class="token operator">-</span><span class="token operator">></span>scrollArea<span class="token operator">-</span><span class="token operator">></span><span class="token function">verticalScrollBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setValue</span><span class="token punctuation">(</span>ui<span class="token operator">-</span><span class="token operator">></span>scrollArea<span class="token operator">-</span><span class="token operator">></span><span class="token function">verticalScrollBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">maximumHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">updateList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
ClientWidget<span class="token operator">::</span><span class="token operator">~</span><span class="token function">ClientWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">delete</span> ui<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">pushMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>ali<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    ITEM <span class="token operator">*</span>it <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ITEM</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ali<span class="token punctuation">,</span> ui<span class="token operator">-</span><span class="token operator">></span>scrollAreaWidgetContents<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">insertWidget</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> it<span class="token operator">-</span><span class="token operator">></span><span class="token function">Item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    items<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>
    it<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">on_pushButtonenter_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">//获取服务器的ip和端口</span>
    QString ip <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>ip<span class="token punctuation">;</span>
    qint16 port <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>port<span class="token punctuation">;</span>
    tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">connectToHost</span><span class="token punctuation">(</span><span class="token function">QHostAddress</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">connect</span><span class="token punctuation">(</span>tcpsocket<span class="token punctuation">,</span><span class="token operator">&amp;</span>QTcpSocket<span class="token operator">::</span>connected<span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                QString str <span class="token operator">=</span> people_new<span class="token operator">+</span>name<span class="token punctuation">;</span>
                tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                emit <span class="token function">logined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">connect</span><span class="token punctuation">(</span>tcpsocket<span class="token punctuation">,</span><span class="token operator">&amp;</span>QTcpSocket<span class="token operator">::</span>readyRead<span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>

                    <span class="token comment" spellcheck="true">//取出接收的内容</span>
                    QByteArray byteBuf <span class="token operator">=</span> tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>byteBuf <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span>   <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//防止空串bug</span>
                    QString buf <span class="token operator">=</span> byteBuf<span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>readyFile<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">//传过来的是文件</span>
                    <span class="token punctuation">{</span>
                        qint64 len <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        recvSize <span class="token operator">+</span><span class="token operator">=</span> len<span class="token punctuation">;</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>recvSize <span class="token operator">==</span> fileSize<span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            QString done<span class="token punctuation">;</span>done<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>sys_flag<span class="token punctuation">)</span><span class="token punctuation">;</span>done<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"filedone"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>done<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            QString str <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"收到文件：[%1: %2KB]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileSize<span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            readyFile <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                            QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"文件信息"</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> head_flag<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//接收头</span>
                    <span class="token punctuation">{</span>
                        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>buf<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
                        buf <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment" spellcheck="true">//解析头部信息 QString buf = "hello##1024"</span>
                        <span class="token comment" spellcheck="true">//初始化</span>
                        fileName <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">"##"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        fileSize <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">"##"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        recvSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                        <span class="token comment" spellcheck="true">//打开文件</span>
<span class="token comment" spellcheck="true">//                        QString filePath1 = QFileDialog::getExistingDirectory(this,"open","./");</span>
<span class="token comment" spellcheck="true">//                        qDebug()&lt;&lt;buf&lt;&lt;" "&lt;&lt;isMSG&lt;&lt;endl;</span>
<span class="token comment" spellcheck="true">//                        QString filePath1 = fileName;</span>
                        file<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//"D:\book\\"+</span>
                        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"收到文件："</span> <span class="token operator">+</span> file<span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
                        <span class="token keyword">bool</span> isOk <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token operator">::</span>WriteOnly<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> isOk<span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"文件信息"</span><span class="token punctuation">,</span><span class="token string">"服务器炸了QWQ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        readyFile <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>people_new<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//P  ip  ! port ! name</span>
                        QString theip <span class="token punctuation">;</span>
                        QString theport<span class="token punctuation">;</span>
                        QString thename<span class="token punctuation">;</span>
                        <span class="token keyword">int</span> thej<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
                        <span class="token keyword">int</span> num<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>thej<span class="token operator">&lt;</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thej<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>thej<span class="token punctuation">]</span><span class="token operator">==</span>sys_flag<span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>
                            theip<span class="token punctuation">[</span>num<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>thej<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        thej<span class="token operator">++</span><span class="token punctuation">;</span>
                        num<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>thej<span class="token operator">&lt;</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thej<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>thej<span class="token punctuation">]</span><span class="token operator">==</span>sys_flag<span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>
                            theport<span class="token punctuation">[</span>num<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>thej<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        thej<span class="token operator">++</span><span class="token punctuation">;</span>
                        num<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>thej<span class="token operator">&lt;</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thej<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            thename<span class="token punctuation">[</span>num<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>thej<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        people thep<span class="token punctuation">;</span>
                        thep<span class="token punctuation">.</span>pip <span class="token operator">=</span> theip<span class="token punctuation">;</span>
                        thep<span class="token punctuation">.</span>name <span class="token operator">=</span> thename<span class="token punctuation">;</span>
                        thep<span class="token punctuation">.</span>pport <span class="token operator">=</span> theport<span class="token punctuation">;</span>
                        plist<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>thep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>people_del<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//D ip ! port</span>
                        QString theip <span class="token punctuation">;</span>
                        QString theport<span class="token punctuation">;</span>
                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

                            <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">==</span>sys_flag<span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>
                            theip<span class="token punctuation">[</span>j<span class="token number">-1</span><span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>

                        <span class="token punctuation">}</span>
                        <span class="token keyword">bool</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                        <span class="token keyword">int</span> num<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>


                            <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">!=</span>sys_flag<span class="token punctuation">)</span><span class="token keyword">continue</span><span class="token punctuation">;</span>
                            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                                <span class="token keyword">continue</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>

                            <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
                                theport<span class="token punctuation">[</span>num<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                                num<span class="token operator">++</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>


                        <span class="token punctuation">}</span>

                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>plist<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pip <span class="token operator">==</span> theip <span class="token operator">&amp;&amp;</span> plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pport <span class="token operator">==</span> theport<span class="token punctuation">)</span><span class="token punctuation">{</span>
                                plist<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">return</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>

                        <span class="token keyword">return</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">left</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> MSG_flag<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">//传过来的是信息</span>
                    <span class="token punctuation">{</span>
                        buf <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"进入聊天室"</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>

                        <span class="token punctuation">}</span>
                        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"离开聊天室"</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>

                        <span class="token punctuation">}</span>
                        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>name <span class="token operator">!=</span> buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            <span class="token function">pushMsg</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token string">"left"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">on_pushButtonsend_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">//获取内容</span>
    QString str <span class="token operator">=</span> ui<span class="token operator">-</span><span class="token operator">></span>input<span class="token operator">-</span><span class="token operator">></span><span class="token function">document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toPlainText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>str <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"提示"</span><span class="token punctuation">,</span><span class="token string">"发送消息不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">pushMsg</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token string">"right"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    str <span class="token operator">=</span> MSG_flag<span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span>str<span class="token punctuation">;</span>
    tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-</span><span class="token operator">></span>input<span class="token operator">-</span><span class="token operator">></span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">on_pushButtonclose_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//关闭</span>
    QString str<span class="token punctuation">;</span>    str<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>sys_flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    str<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"Close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">disconnectFromHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//选择文件按钮</span>
<span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">on_selectButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    QString filePath2 <span class="token operator">=</span> QFileDialog<span class="token operator">::</span><span class="token function">getOpenFileName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"open"</span><span class="token punctuation">,</span><span class="token string">"../"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> filePath2<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//如果选择文件路径有效</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//初始化</span>
        fileName2<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileSize2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        sendSize2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//获取文件信息</span>
        QFileInfo <span class="token function">info</span><span class="token punctuation">(</span>filePath2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileName2 <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileSize2 <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//只读方式打开文件</span>
        <span class="token comment" spellcheck="true">//指定文件名</span>
        file2<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span>filePath2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//打开文件</span>
        <span class="token keyword">bool</span> isOk <span class="token operator">=</span> file2<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token operator">::</span>ReadOnly<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> isOk<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"只读方式打开文件失败 77"</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        upload<span class="token operator">-</span><span class="token operator">></span><span class="token function">setWindowTitle</span><span class="token punctuation">(</span><span class="token string">"文件上传"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> fileSize2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setParent</span><span class="token punctuation">(</span>upload<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-</span><span class="token operator">></span>sendButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setParent</span><span class="token punctuation">(</span>upload<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-</span><span class="token operator">></span>sendButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-</span><span class="token operator">></span>sendButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        upload<span class="token operator">-</span><span class="token operator">></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"选择文件路径出错 62"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">//反向发送按钮</span>
<span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">on_sendButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"on_sendButton_clicked"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//先发送文件头信息 文件名##文件大小</span>
    QString head <span class="token operator">=</span> head_flag <span class="token operator">+</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"##%1##%2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileName2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileSize2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>head<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//发送头部信息</span>
    qint64 len <span class="token operator">=</span> tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>head<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//头部信息发送成功</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//发送真正的文件信息</span>
        <span class="token comment" spellcheck="true">//防止TCP黏包，需要通过定时器延时20ms</span>
        timer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//文件传输计时器</span>
        <span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timer<span class="token punctuation">,</span><span class="token operator">&amp;</span>QTimer<span class="token operator">::</span>timeout<span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">//关闭定时器</span>
                    timer<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment" spellcheck="true">//发送文件</span>

                    <span class="token function">sendData</span><span class="token punctuation">(</span>tcpsocket<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"头部信息发送失败 110"</span><span class="token punctuation">;</span>
        file2<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//发送文件</span>
<span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">sendData</span><span class="token punctuation">(</span>QTcpSocket<span class="token operator">*</span> tcpSocket<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    qint64 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">do</span>
    <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//每次发送数据的单位（缓冲区大小）</span>
        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">//往文件中读数据</span>
        len <span class="token operator">=</span> file2<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        len <span class="token operator">=</span> tcpSocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//发送的数据需要累积</span>
        sendSize2 <span class="token operator">+</span><span class="token operator">=</span> len<span class="token punctuation">;</span>
        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setValue</span><span class="token punctuation">(</span>sendSize2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//判断是否发送文件完毕</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>sendSize2 <span class="token operator">==</span> fileSize2<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"transport"</span><span class="token punctuation">,</span> <span class="token string">"文件发送完毕！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sendSize2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//以免重复弹出完成提示</span>
    <span class="token punctuation">}</span>
    file2<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    upload<span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">/*****************************音频信息*************************/</span>
<span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">readyReadSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> size <span class="token operator">=</span> output<span class="token operator">-</span><span class="token operator">></span><span class="token function">periodSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        QByteArray bug<span class="token punctuation">;</span>
        video vp<span class="token punctuation">;</span>
        <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>vp<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>vp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//监听音频   并且传送</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"我在接收呢"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
        bug <span class="token operator">=</span> phone_tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        outputDevice<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>bug<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">onReadyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//send</span>
<span class="token punctuation">{</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"It's sending audio!"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
        video vp<span class="token punctuation">;</span>
        <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>vp<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>vp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//读取音频</span>
        vp<span class="token punctuation">.</span>lens <span class="token operator">=</span> inputDevice<span class="token operator">-</span><span class="token operator">></span><span class="token function">read</span><span class="token punctuation">(</span>vp<span class="token punctuation">.</span>audiodata<span class="token punctuation">,</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        phone_tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>vp<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>vp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//先给服务发送(接收文件完成的信息)</span>
<span class="token punctuation">}</span></code></pre>
<h6 id="main-cpp-1"><a href="#main-cpp-1" class="headerlink" title="main.cpp"></a>main.cpp</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clientwidget.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QApplication></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QStyleFactory></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QWidget></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    QApplication <span class="token function">a</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    a<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>QStyleFactory<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"Fusion"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ClientWidget w<span class="token punctuation">;</span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h4><ul>
<li>仅仅支持同一局域网内通讯</li>
<li>若连接外网（比如河北的物理机）可以使用花生壳（免费1G）等端口映射工具；</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/05/14/scanf-%E8%B8%A9%E5%9D%91/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="scanf 踩坑" class="lazyload">
                    <h1>scanf 踩坑</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow-fill">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年05月14日</a>
            <a><i class="nexmoefont icon-areachart"></i>34 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <p>scanf(“%c”,ch);这样会读入空格和回车符<br><img data-fancybox="gallery" data-sizes="auto" data-src="https://img-blog.csdnimg.cn/20200514173404162.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU1Mjk2MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述" class="lazyload">以下两种写法可以忽略回车符和空格</p>
<pre class=" language-cpp"><code class="language-cpp">cin<span class="token operator">>></span>ch<span class="token punctuation">;</span>
<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">" %c"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/05/13/%E4%BD%8D%E8%BF%90%E7%AE%97/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="位运算" class="lazyload">
                    <h1>位运算</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow-fill">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年05月13日</a>
            <a><i class="nexmoefont icon-areachart"></i>55 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <p>查询状态S中是否有编号为 i 的点</p>
<pre class=" language-c++"><code class="language-c++">if(S & (1 << i)) return true;
else return false;</code></pre>
<p>在状态 S 中添加编号为 i 的点</p>
<pre class=" language-c++"><code class="language-c++">S = S | (1 << i)</code></pre>
<p>在状态 S 中删除编号为 i 的点</p>
<pre><code>if(S &amp; (1 &lt;&lt; i))
    S = S ^ (1 &lt;&lt; i);</code></pre><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/05/11/%E9%9A%8F%E8%AE%B0/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="随记" class="lazyload">
                    <h1>随记</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow-fill">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年05月11日</a>
            <a><i class="nexmoefont icon-areachart"></i>144 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <h6 id="2020-05-11-晴"><a href="#2020-05-11-晴" class="headerlink" title="2020/05/11  晴"></a>2020/05/11  晴</h6><p>月下长饮一杯酒，怀念被写到泪流。月下卷入一莫愁，过往被写到泪流</p>
<h6 id="2020-05-14-小雨"><a href="#2020-05-14-小雨" class="headerlink" title="2020/05/14   小雨"></a>2020/05/14   小雨</h6><p>浮生有梦三千场，穷尽千里诗酒荒</p>
<h6 id="2020-05-18-晴"><a href="#2020-05-18-晴" class="headerlink" title="2020/05/18  晴"></a>2020/05/18  晴</h6><p>江雨霏霏江草齐，六朝如梦鸟空啼。<br><strong>无情最是台城柳</strong>，依旧烟笼十里堤。          —–唐.韦庄《台城|金陵图》</p>
<h5 id="2020-05-20-12-27"><a href="#2020-05-20-12-27" class="headerlink" title="2020/05/20/12:27"></a>2020/05/20/12:27</h5><p>点燃一场支离破碎的美梦</p>
<p>看光阴散落下的满眼绯红</p>
<h6 id="2020-05-21"><a href="#2020-05-21" class="headerlink" title="2020/05/21"></a>2020/05/21</h6><p>这世界的节奏太快了，快到没有时间看一下别人的建议。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/05/11/%E4%B9%A6%E7%B1%8D%E6%B8%85%E5%8D%95/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="书籍清单" class="lazyload">
                    <h1>书籍清单</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow-fill">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年05月11日</a>
            <a><i class="nexmoefont icon-areachart"></i>137 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <h6 id="Done"><a href="#Done" class="headerlink" title="Done"></a>Done</h6><p>大一上：NULL</p>
<p>大一下：</p>
<p>你只是假装很努力   √</p>
<p>三毛，上天独宠的追梦人  √</p>
<p>梦里花落知多少  √</p>
<p>雨季不再来  √</p>
<p>我们仨  √</p>
<p>天才在左疯子在右  √</p>
<p>追风筝的人  √</p>
<p>明朝那些事  √</p>
<p>孝经  √</p>
<p>大二：</p>
<p>许三观卖血记  √</p>
<p>人间失格  √</p>
<p>活着  √</p>
<p>了凡四训  √</p>
<p>你今天真好看  √</p>
<p>谁动了我的奶酪  √</p>
<p>大二</p>
<h6 id="Will"><a href="#Will" class="headerlink" title="Will"></a>Will</h6><p>摆渡人 ing</p>
<p>阿勒泰的角落 </p>
<p>瓦尔登湖</p>
<p>静静的顿河</p>
<p>偷影子的人</p>
<p>杀死一只知更鸟</p>
<p>鲁迅文集</p>
<p>云边有个小卖部</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://s1.ax1x.com/2020/06/02/tYHYzd.png" alt="image-20200512090808739" class="lazyload"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/05/10/%E5%BE%85%E7%9C%8B%E7%94%B5%E5%BD%B1%E6%B8%85%E5%8D%95/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="待看电影清单" class="lazyload">
                    <h1>待看电影清单</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow-fill">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年05月10日</a>
            <a><i class="nexmoefont icon-areachart"></i>12 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <h1 id="电影清单"><a href="#电影清单" class="headerlink" title="电影清单"></a>电影清单</h1><p>《星际穿越》<br>《返老还童》</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            
        </article>
    </div>
    
    <div class="nexmoe-post">
        <a href="/2020/05/10/%E5%8C%BA%E9%97%B4DP/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/nexmoe/nexmoe.github.io@latest/images/cover/5c3aec85a4343.jpg" data-sizes="auto" alt="DP" class="lazyload">
                    <h1>DP</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow-fill">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年05月10日</a>
            <a><i class="nexmoefont icon-areachart"></i>103 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 1 分钟</a>
        </div>

        <article>
            
                <h1 id="区间DP"><a href="#区间DP" class="headerlink" title="区间DP"></a>区间DP</h1><p>什么是区间DP？</p>
<p>线性动态规划的一种扩展</p>
<p>在区间上进行的DP，通常是将大区间分割成小区间进行DP</p>
<p>在分阶段划分问题时，与阶段中元素出现的顺序和由前一阶段的哪写元素合并过来有很大关系</p>
<p>常见的转移方程类型</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="/.io//C:%5CUsers%5Clenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200510160243296.png" alt="image-20200510160243296" class="lazyload"></p>
<h4 id="题目：：："><a href="#题目：：：" class="headerlink" title="题目：：："></a>题目：：：</h4><p><a href="https://blog.csdn.net/mengxiang000000/article/details/73610401" target="_blank" rel="noopener">https://blog.csdn.net/mengxiang000000/article/details/73610401</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            
        </article>
    </div>
    
</section>

    <nav class="nexmoe-page-nav">
      <a class="extend prev" rel="prev" href="/archives/"><i class="nexmoefont icon-left"></i></a><a class="page-number" href="/archives/">1</a><span class="page-number current">2</span><a class="page-number" href="/archives/page/3/">3</a><a class="extend next" rel="next" href="/archives/page/3/"><i class="nexmoefont icon-right"></i></a>
    </nav>
  
        <div class="nexmoe-post-right">
          <div class="nexmoe-fixed">
            <div class="nexmoe-tool"> 
              
                
              
              <a href="#nexmoe-content" class="toc-link" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
            </div>
          </div>
        </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,gh/highlightjs/cdn-release@9.15.8/build/highlight.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>
<script>
	hljs.initHighlightingOnLoad();
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


<script src="https://cdn.jsdelivr.net/gh/xtaodada/xtaodada.github.io@0.0.2/copy.js"></script>
 

<script src="/js/app.js?v=1620466069045"></script>

<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>

  





</body>

</html>
