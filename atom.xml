<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>左轮</title>
  
  <subtitle>暮商十五</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://liushuo1999.github.io/"/>
  <updated>2020-05-27T14:41:12.905Z</updated>
  <id>http://liushuo1999.github.io/</id>
  
  <author>
    <name>LiuShuo</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>动态规划(一)</title>
    <link href="http://liushuo1999.github.io/2020/05/27/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E4%B8%80/"/>
    <id>http://liushuo1999.github.io/2020/05/27/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E4%B8%80/</id>
    <published>2020-05-26T23:16:50.000Z</published>
    <updated>2020-05-27T14:41:12.905Z</updated>
    
    <content type="html"><![CDATA[<h3 id="动态规划两种基本思想："><a href="#动态规划两种基本思想：" class="headerlink" title="动态规划两种基本思想："></a>动态规划两种基本思想：</h3><h4 id="带备忘的自顶向下法（top-down-with-memoization）："><a href="#带备忘的自顶向下法（top-down-with-memoization）：" class="headerlink" title="带备忘的自顶向下法（top-down with memoization）："></a>带备忘的自顶向下法（top-down with memoization）：</h4><p>按自然递归编写过程，保存每个子问题的解（通常保存在一个数组 或散列表中）。当需要一个子问题的解时，首先检查是否已经保存 过此解，如果是则直接返回；否则，按通常方式计算这个子问题。</p><h4 id="自底向上法（bottom-up-method）"><a href="#自底向上法（bottom-up-method）" class="headerlink" title="自底向上法（bottom-up method）"></a>自底向上法（bottom-up method）</h4><p>一般需要恰当定义子问题“规模”的概念，使得任何子问题的求解 都只依赖于“更小的”子问题的求解。按从小到大的顺序依次进行 求解子问题。当求解某个子问题时，它所依赖的更小的子问题都已 求解过。</p><h3 id="动态规划的基本概念"><a href="#动态规划的基本概念" class="headerlink" title="动态规划的基本概念"></a>动态规划的基本概念</h3><ul><li><p>通过合理“组合”子问题的解 从而解决 整个问题解的一种算法。其中 的子问题并不是独立的，这些子问题又包含有公共的子问题。</p></li><li><p>动态规划算法就是对每个子问题只求一次，并将其结果保存在一张表中 (数组)，以后再用到时直接从表中拿过来使用，避免重复计算相同的子问 题。</p></li><li><p>“不做无用功”的求解模式，大大提高了程序的效率。</p></li><li><p>动态规划算法常用于解决统计类问题（统计方案总数）和最优值问题 （最大值或最小值），尤其普遍用于最优化问题。 </p></li></ul><h3 id="动态规划问题的特征"><a href="#动态规划问题的特征" class="headerlink" title="动态规划问题的特征"></a>动态规划问题的特征</h3><p>一、最优子结构  </p><ul><li><p>如果问题的一个最优解中包含了子问题的最优解，则该问题具有最 优子结构。也称最优化原理。</p></li><li><p>最优子结构也可以理解为“整体最优则局部最优”。反之不一定成 立。 \</p></li></ul><p>二、重叠子问题</p><ul><li>在解决整个问题时，要先解决其子问题，要解决这些子问题，又要 先解决他们的子问题……而这些子问题又不是相互独立的，有很多是 重复的，这些重复的子问题称为重叠子问题。</li><li>动态规划算法正是利用了这种子问题的重叠性质，对每一个子问题 只解一次，而后将其解保存在一个表中，以后再遇到这些相同问题 时直接查表就可以，而不需要再重复计算，每次查表的时间为常数。</li></ul><p>三、无后效性原则 </p><ul><li>已经求得的状态，不受未求状态的影响。 </li><li>设计的状态满足拓扑关系。</li></ul><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ol><li>找出最优解的性质，并刻画其结构特征； </li><li>递归地定义最优值（写出动态规划方程）； </li><li>以自底向上（递推）或带备忘的自顶向下（记忆化搜索）的方式计算出最 优值； </li><li>根据计算最优值时得到的信息，构造一个最优解。</li></ol><h3 id="动态规划的关键："><a href="#动态规划的关键：" class="headerlink" title="动态规划的关键："></a>动态规划的关键：</h3><ul><li>状态转移方程的构造是动态规划过程中最重要的一步，也是最难的一步。 对于大多数的动态规划,寻找状态转移方程有一条十分高效的通道，就是 寻找变化中的不变量（已经求得的值）。 </li><li>定量处理的过程也就是决策实施的过程。</li></ul><h3 id="动态规划与贪心法的不同："><a href="#动态规划与贪心法的不同：" class="headerlink" title="动态规划与贪心法的不同："></a>动态规划与贪心法的不同：</h3><ul><li><p>贪心算法：“先决策，再求解子问题” </p></li><li><p>动态规划：“先求得子问题的解，然后决策”</p></li><li><p>动态规划的一般格式为：</p><ul><li>for k取遍所有状态do            //枚举阶段</li><li>for U取遍所有状态do           //枚举状态</li><li>for X取遍所有决策 do //枚举决策</li><li>// 状态转移</li></ul></li></ul><h3 id="Q"><a href="#Q" class="headerlink" title="Q"></a>Q</h3><h4 id="爬台阶问题"><a href="#爬台阶问题" class="headerlink" title="爬台阶问题"></a>爬台阶问题</h4><p>他要去 N3 楼做实验，要爬台阶到三楼，其中一共有 n 级台阶， 一步可以走 1, 2, 3, …, k 阶，诶，同时有些台阶不能落脚，问走到第 n 阶 的最方案数。</p><p><img src="https://s1.ax1x.com/2020/05/27/tkEVjU.png" alt="爬台阶问题"></p><h4 id="最大区间和"><a href="#最大区间和" class="headerlink" title="最大区间和"></a>最大区间和</h4><p>N 个数字，每个数字∈[-1e9,1e9]，东东想选定一个区间使得和最大，求 这个和。</p><p>最直接的——贪心做法，维护前缀和 sum[n]，假如我们选了 [L, R]，那么 答案就是 ans = sum[R] – sum[L-1] </p><ul><li><p>i = 1 到 n，遍历一遍，假设 i = R，更新答案 ans=sum[i]-sum[L-1] </p></li><li><p>需要记录一个 L (L&lt;=i)，使得 sum[L-1] 是 sum 数组中最小的</p></li></ul><p><img src="https://s1.ax1x.com/2020/05/27/tkeMNj.png" alt=""></p><p><img src="https://s1.ax1x.com/2020/05/27/tkKyJH.png" alt=""></p><p>备注：dp[i][1]表示要么i位置之前使用过魔法，要么i位置使用魔法，所以是四个选项取max</p><h4 id="走地图"><a href="#走地图" class="headerlink" title="走地图"></a>走地图</h4><p>东东在一个 n×m的地图上，起点为左下角，终点为右上角，东东只能向 右或向上行走，询问走到终点的方案数。</p><p>假定有些点存在障碍物而不可行走，又应当如何设计？</p><ul><li>定状态：定义 f[i][j] 表示从起点到(i,j)点的方案数。</li><li>状态转移方程为： f[i][j] = f[i-1][j] + f[i][j-1],（当(i-1,j)和(i,j-1)两点合法时） </li><li>初始化：f[1][1] = 1</li><li>输出答案：f[n][m]</li></ul><h4 id="拿数问题"><a href="#拿数问题" class="headerlink" title="拿数问题"></a>拿数问题</h4><p>给 n 个数，每一步能拿走一个数，比如拿第 i 个数，A[i] = x，得到相应的分 数 x，但拿掉这个Ai 后，A[i+1] 和A[i-1] 就会变得不可拿。求最大分数。</p><ul><li>dp[i] ，仅考虑A[1..i] ，能拿到的最大分数 </li><li>dp[i] = max(dp[i-1], dp[i-2]+A[i])</li></ul><h4 id="东东弹钢琴"><a href="#东东弹钢琴" class="headerlink" title="东东弹钢琴"></a>东东弹钢琴</h4><p>东东最近喜欢弹钢琴(在梦中)，一段旋律中的每个音符都可以用一个小写 英文字母表示。当组成一段旋律的字符 ASCII码是非递减的，旋律被称为 是高昂的，例如 aaa,bcd. 现在东东已经学会了 n 段高昂的旋律，他想利用它们拼接处一个尽可能 长的高昂的旋律，问最长长度是多少？(n&lt;=1e6, 字符串长度和 &lt;=1e6)</p><pre class=" language-cpp"><code class="language-cpp"><span class="token number">5</span> bcdefhijk bcd aaa eeeefghhh zzzz答案是 <span class="token number">19</span>（aaa<span class="token punctuation">,</span> bcd<span class="token punctuation">,</span> eeeefghhh<span class="token punctuation">,</span> zzz）</code></pre><p><img src="https://s1.ax1x.com/2020/05/27/tk80eI.png" alt=""></p><h4 id="矩阵选数"><a href="#矩阵选数" class="headerlink" title="矩阵选数"></a>矩阵选数</h4><p>矩阵选数 (原阿里校招-3.25-A题)：</p><p>  给定一个矩阵 3*n，</p><pre class=" language-cpp"><code class="language-cpp">比如 <span class="token number">5</span> <span class="token number">10</span> <span class="token number">5</span> <span class="token number">4</span> <span class="token number">4</span> <span class="token number">1</span> <span class="token number">7</span>  <span class="token number">8</span> <span class="token number">4</span> <span class="token number">0</span> <span class="token number">3</span> <span class="token number">4</span>  <span class="token number">9</span> <span class="token number">0</span> <span class="token number">3</span></code></pre><p>从每一列选择一个数，求出后一列减去前一列的绝对值的和的最小值  比如这里就是5 4 5 4 4，使得 |4-5|+|5-4|+|4-5|+|4-4| 最小，输出是 5 </p><pre class=" language-cpp"><code class="language-cpp">发现每一列只会和前一列关联  定状态：定义 dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span> 表示仅考虑前 i 列，并且第 i 列选的是第 <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span> 数的最小答案。 状态转移方程为： dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">min</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token number">-1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">|</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token number">-1</span><span class="token punctuation">]</span><span class="token operator">|</span><span class="token punctuation">,</span>                dp<span class="token punctuation">[</span>i<span class="token number">-1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">|</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token number">-1</span><span class="token punctuation">]</span><span class="token operator">|</span><span class="token punctuation">,</span>                dp<span class="token punctuation">[</span>i<span class="token number">-1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">|</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token number">-1</span><span class="token punctuation">]</span><span class="token operator">|</span><span class="token punctuation">)</span> 其他两个转移方程dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>、dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> 同理 初始化：dp<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span>INF<span class="token punctuation">,</span> dp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span>  输出答案：dp<span class="token punctuation">[</span>n<span class="token punctuation">]</span></code></pre><h2 id="前往作业"><a href="#前往作业" class="headerlink" title="前往作业"></a><a href="https://blog.csdn.net/weixin_44552961/article/details/106391146" target="_blank" rel="noopener">前往作业</a></h2><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;动态规划两种基本思想：&quot;&gt;&lt;a href=&quot;#动态规划两种基本思想：&quot; class=&quot;headerlink&quot; title=&quot;动态规划两种基本思想：&quot;&gt;&lt;/a&gt;动态规划两种基本思想：&lt;/h3&gt;&lt;h4 id=&quot;带备忘的自顶向下法（top-down-with-memoi
      
    
    </summary>
    
    
    
      <category term="动态规划" scheme="http://LiuShuo1999.github.io/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"/>
    
  </entry>
  
  <entry>
    <title>程序设计总结</title>
    <link href="http://liushuo1999.github.io/2020/05/27/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E6%80%BB%E7%BB%93/"/>
    <id>http://liushuo1999.github.io/2020/05/27/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E6%80%BB%E7%BB%93/</id>
    <published>2020-05-26T23:15:28.000Z</published>
    <updated>2020-05-27T14:45:20.940Z</updated>
    
    <content type="html"><![CDATA[<p>程序设计，练习代码能力，养成自己的代码风格。</p><p>总结该学期知识</p><h3 id="第一周"><a href="#第一周" class="headerlink" title="第一周"></a>第一周</h3><h3 id="第二周"><a href="#第二周" class="headerlink" title="第二周"></a>第二周</h3><h3 id="第三周"><a href="#第三周" class="headerlink" title="第三周"></a>第三周</h3><h3 id="第四周"><a href="#第四周" class="headerlink" title="第四周"></a>第四周</h3><h3 id="第五周"><a href="#第五周" class="headerlink" title="第五周"></a>第五周</h3><h3 id="第六周"><a href="#第六周" class="headerlink" title="第六周"></a>第六周</h3><h3 id="第七周"><a href="#第七周" class="headerlink" title="第七周"></a>第七周</h3><h3 id="第八周"><a href="#第八周" class="headerlink" title="第八周"></a>第八周</h3><h3 id="第九周"><a href="#第九周" class="headerlink" title="第九周"></a>第九周</h3><h3 id="第十周-动态规划-一"><a href="#第十周-动态规划-一" class="headerlink" title="第十周    动态规划(一)"></a>第十周    动态规划(一)</h3><p>通往总结</p><p><a href="https://vjudge.net/contest/369589#overview" target="_blank" rel="noopener">通往作业</a></p><table><thead><tr><th>习题</th><th>类型</th></tr></thead><tbody><tr><td><a href="https://vjudge.net/problem/CodeForces-1141A" target="_blank" rel="noopener">A - 签到题</a></td><td>动态规划</td></tr><tr><td><a href="https://vjudge.net/problem/Gym-277140A" target="_blank" rel="noopener">B - LIS &amp; LCS</a></td><td>最长上升序列，最长公共序列</td></tr><tr><td><a href="https://vjudge.net/problem/CodeForces-455A" target="_blank" rel="noopener">C - 拿数问题 II</a></td><td>动态规划</td></tr></tbody></table><p><a href="https://vjudge.net/contest/369421#problem/A" target="_blank" rel="noopener">通往大模拟</a></p><h3 id="第十一周"><a href="#第十一周" class="headerlink" title="第十一周"></a>第十一周</h3><h3 id="第十二周"><a href="#第十二周" class="headerlink" title="第十二周"></a>第十二周</h3><h3 id="第十三周"><a href="#第十三周" class="headerlink" title="第十三周"></a>第十三周</h3><h3 id="第十四周"><a href="#第十四周" class="headerlink" title="第十四周"></a>第十四周</h3><h3 id=""><a href="#" class="headerlink" title=""></a></h3><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;程序设计，练习代码能力，养成自己的代码风格。&lt;/p&gt;
&lt;p&gt;总结该学期知识&lt;/p&gt;
&lt;h3 id=&quot;第一周&quot;&gt;&lt;a href=&quot;#第一周&quot; class=&quot;headerlink&quot; title=&quot;第一周&quot;&gt;&lt;/a&gt;第一周&lt;/h3&gt;&lt;h3 id=&quot;第二周&quot;&gt;&lt;a href=&quot;#第
      
    
    </summary>
    
    
    
      <category term="程序设计" scheme="http://LiuShuo1999.github.io/tags/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="总结" scheme="http://LiuShuo1999.github.io/tags/%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>vector 去重</title>
    <link href="http://liushuo1999.github.io/2020/05/26/vector-%E5%8E%BB%E9%87%8D/"/>
    <id>http://liushuo1999.github.io/2020/05/26/vector-%E5%8E%BB%E9%87%8D/</id>
    <published>2020-05-26T07:37:37.000Z</published>
    <updated>2020-05-26T07:39:11.936Z</updated>
    
    <content type="html"><![CDATA[<h2 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h2><pre class=" language-cpp"><code class="language-cpp"><span class="token function">sort</span><span class="token punctuation">(</span>vector<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>vector<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>vector<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span>vector<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>vector<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vector<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;vector&quot;&gt;&lt;a href=&quot;#vector&quot; class=&quot;headerlink&quot; title=&quot;vector&quot;&gt;&lt;/a&gt;vector&lt;/h2&gt;&lt;pre class=&quot; language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;sp
      
    
    </summary>
    
    
    
      <category term="STL" scheme="http://LiuShuo1999.github.io/tags/STL/"/>
    
      <category term="vector" scheme="http://LiuShuo1999.github.io/tags/vector/"/>
    
  </entry>
  
  <entry>
    <title>QT全局变量声明</title>
    <link href="http://liushuo1999.github.io/2020/05/19/QT%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E/"/>
    <id>http://liushuo1999.github.io/2020/05/19/QT%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E/</id>
    <published>2020-05-19T07:46:39.000Z</published>
    <updated>2020-05-19T09:10:26.018Z</updated>
    
    <content type="html"><![CDATA[<p>可以另开一个头文件，里面声明一个类，类里面的全局变量声明为static类型；</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;可以另开一个头文件，里面声明一个类，类里面的全局变量声明为static类型；&lt;/p&gt;
&lt;script&gt;
        document.querySelectorAll(&#39;.github-emoji&#39;)
          .forEach(el =&gt; {
       
      
    
    </summary>
    
    
    
      <category term="QT" scheme="http://LiuShuo1999.github.io/tags/QT/"/>
    
      <category term="面向对象编程" scheme="http://LiuShuo1999.github.io/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/"/>
    
      <category term="全局变量" scheme="http://LiuShuo1999.github.io/tags/%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F/"/>
    
  </entry>
  
  <entry>
    <title>QT-TCP通讯</title>
    <link href="http://liushuo1999.github.io/2020/05/16/QT-TCP%E9%80%9A%E8%AE%AF/"/>
    <id>http://liushuo1999.github.io/2020/05/16/QT-TCP%E9%80%9A%E8%AE%AF/</id>
    <published>2020-05-16T07:21:38.000Z</published>
    <updated>2020-05-17T13:12:27.850Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h4 id="实现内容"><a href="#实现内容" class="headerlink" title="实现内容"></a>实现内容</h4><ul><li>多人聊天室</li><li>文件传输</li><li>多人语音聊天室</li></ul><h4 id="效果截图"><a href="#效果截图" class="headerlink" title="效果截图"></a>效果截图</h4><h5 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h5><p><img src="/.io//C:%5CUsers%5Clenovo%5CDesktop%5C12.png" alt="服务器"></p><h5 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h5><p><img src="/.io//C:%5CUsers%5Clenovo%5CDesktop%5C12.png" alt="12"></p><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><h5 id="服务器端-1"><a href="#服务器端-1" class="headerlink" title="服务器端"></a>服务器端</h5><p>注 pro文件需要添加</p><p><code>QT       += core gui network multimedia</code></p><h6 id="serverwidget-h"><a href="#serverwidget-h" class="headerlink" title="serverwidget.h"></a>serverwidget.h</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">ifndef</span> SERVERWIDGET_H</span><span class="token macro property">#<span class="token directive keyword">define</span> SERVERWIDGET_H</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QWidget></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTcpServer></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTcpSocket></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QVector></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFile></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTimer></span></span><span class="token comment" spellcheck="true">//计时器</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudio></span></span><span class="token comment" spellcheck="true">//一下这五个是QT处理音频的库</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudioFormat></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudioInput></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudioOutput></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QIODevice></span></span>QT_BEGIN_NAMESPACE<span class="token keyword">namespace</span> Ui <span class="token punctuation">{</span> <span class="token keyword">class</span> <span class="token class-name">ServerWidget</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>QT_END_NAMESPACE<span class="token keyword">struct</span> people<span class="token punctuation">{</span>    QString pip<span class="token punctuation">;</span>    QString name<span class="token punctuation">;</span>    <span class="token keyword">int</span> pport<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/*********************************************/</span><span class="token keyword">const</span> <span class="token keyword">char</span> file_flag <span class="token operator">=</span> <span class="token string">'F'</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span> head_flag <span class="token operator">=</span> <span class="token string">'H'</span><span class="token punctuation">;</span><span class="token keyword">const</span> QString MSG_flag <span class="token operator">=</span> <span class="token string">"MSG##"</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span> sys_flag <span class="token operator">=</span> <span class="token string">'!'</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span> people_new <span class="token operator">=</span> <span class="token string">'N'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//新的用户到来  姓名传输过来</span><span class="token keyword">const</span> <span class="token keyword">char</span> to_c_people_new <span class="token operator">=</span> <span class="token string">'P'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//新的用户到来  传给客户端</span><span class="token keyword">const</span> <span class="token keyword">char</span> to_c_people_del <span class="token operator">=</span> <span class="token string">'D'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//新的用户离开  传给客户端</span><span class="token comment" spellcheck="true">/*********************************************/</span><span class="token keyword">class</span> <span class="token class-name">ServerWidget</span> <span class="token operator">:</span> <span class="token keyword">public</span> QWidget<span class="token punctuation">{</span>    Q_OBJECT<span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">ServerWidget</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">~</span><span class="token function">ServerWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">private</span> slots<span class="token operator">:</span>    <span class="token keyword">void</span> <span class="token function">on_pushButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//</span>    <span class="token keyword">void</span> <span class="token function">on_ButtonSelect_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">on_ButtonSend_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">sendData</span><span class="token punctuation">(</span>QTcpSocket<span class="token operator">*</span> tcpSocket<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//发送文件数据</span>    <span class="token keyword">void</span> <span class="token function">onReadyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">readyReadSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//receive</span><span class="token keyword">private</span><span class="token operator">:</span>    Ui<span class="token operator">::</span>ServerWidget <span class="token operator">*</span>ui<span class="token punctuation">;</span>    QTcpServer <span class="token operator">*</span>tcpserver<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//监听套接字</span>    QVector<span class="token operator">&lt;</span>QTcpSocket <span class="token operator">*</span><span class="token operator">></span> socketarr<span class="token punctuation">;</span>    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    QFile  file<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件对象</span>    QString fileName<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//文件名字</span>    QString filePath<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//文件路径</span>    qint64 fileSize<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件大小</span>    qint64 sendSize<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//已发送文件大小</span>        QTimer timer<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//定时器  黏包  头部----文件体</span>    QFile  file2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件对象</span>    QString fileName2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件名字</span>    qint64 fileSize2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件大小</span>    qint64 recvSize2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//已发送文件大小</span>    <span class="token keyword">bool</span> readyFile<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/*********************************************/</span>    QVector<span class="token operator">&lt;</span>people<span class="token operator">></span> plist<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/*********************************************/</span>    <span class="token comment" spellcheck="true">/*音频*/</span>    QVector<span class="token operator">&lt;</span>QTcpSocket <span class="token operator">*</span><span class="token operator">></span> phonetcpsocket<span class="token punctuation">;</span>    QTcpServer <span class="token operator">*</span>phonetcpserver<span class="token punctuation">;</span>    <span class="token keyword">int</span> phone_count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    QAudioInput <span class="token operator">*</span>input<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//音频采集</span>    QIODevice   <span class="token operator">*</span>inputDevice<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//播放</span>    QAudioOutput <span class="token operator">*</span>output<span class="token punctuation">;</span>    QIODevice   <span class="token operator">*</span>outputDevice<span class="token punctuation">;</span><span class="token keyword">protected</span><span class="token operator">:</span>    <span class="token keyword">void</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> video<span class="token punctuation">{</span>    <span class="token keyword">char</span> audiodata<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> lens<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment" spellcheck="true">// SERVERWIDGET_H</span></code></pre><h6 id="serverwidget-cpp"><a href="#serverwidget-cpp" class="headerlink" title="serverwidget.cpp"></a>serverwidget.cpp</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"serverwidget.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ui_serverwidget.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFileDialog></span></span><span class="token comment" spellcheck="true">//选择文件的对话框</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QDebug></span></span><span class="token comment" spellcheck="true">//用于debug</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFileInfo></span></span><span class="token comment" spellcheck="true">//用于获取文件信息</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QMap></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QStyleFactory></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QPainter></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QMessageBox></span></span>ServerWidget<span class="token operator">::</span><span class="token function">ServerWidget</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span>    <span class="token operator">:</span> <span class="token function">QWidget</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>    <span class="token punctuation">,</span> <span class="token function">ui</span><span class="token punctuation">(</span><span class="token keyword">new</span> Ui<span class="token operator">::</span>ServerWidget<span class="token punctuation">)</span><span class="token punctuation">{</span>    ui<span class="token operator">-</span><span class="token operator">></span><span class="token function">setupUi</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    tcpserver <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    recvSize2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    readyFile <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    tcpserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QTcpServer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//监听套接字</span>    ui<span class="token operator">-</span><span class="token operator">></span>pushButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color: rgb(175,238,238)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>textEdit_online<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color: rgba(255, 0, 255, 60)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>textEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color: rgba(0, 255, 255, 60)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>textEditFile<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color: rgba(255, 0, 255, 60)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">1024</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>sendSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    QPainter <span class="token function">p</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    p<span class="token punctuation">.</span><span class="token function">drawPixmap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">QPixmap</span><span class="token punctuation">(</span><span class="token string">"../src/b3.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>ServerWidget<span class="token operator">::</span><span class="token operator">~</span><span class="token function">ServerWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">delete</span> ui<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//聊天室按钮</span><span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">on_pushButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//获取端口号</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>ui<span class="token operator">-</span><span class="token operator">></span>lineEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>    qint16 port <span class="token operator">=</span> ui<span class="token operator">-</span><span class="token operator">></span>lineEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//监听</span>    tcpserver<span class="token operator">-</span><span class="token operator">></span><span class="token function">listen</span><span class="token punctuation">(</span>QHostAddress<span class="token operator">::</span>Any<span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setWindowTitle</span><span class="token punctuation">(</span><span class="token string">"服务器："</span><span class="token operator">+</span>ui<span class="token operator">-</span><span class="token operator">></span>lineEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>textEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"聊天室创建成功！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//如果新进客户端与服务器连接，tcpServer会自动触发newConnection()</span>    <span class="token function">connect</span><span class="token punctuation">(</span>tcpserver<span class="token punctuation">,</span><span class="token operator">&amp;</span>QTcpServer<span class="token operator">::</span>newConnection<span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">{</span>                     count<span class="token operator">++</span><span class="token punctuation">;</span>                     ui<span class="token operator">-</span><span class="token operator">></span>labelonline<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"当前在线人数："</span><span class="token operator">+</span>QString<span class="token operator">::</span><span class="token function">number</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment" spellcheck="true">//取出socket</span>                     QTcpSocket <span class="token operator">*</span>socket<span class="token punctuation">;</span>                     socket <span class="token operator">=</span> tcpserver<span class="token operator">-</span><span class="token operator">></span><span class="token function">nextPendingConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment" spellcheck="true">//加入数组</span>                     socketarr<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>                     QString ip <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出ip</span>                     ip <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//删除前缀</span>                     qint16 port <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出端口</span>                     <span class="token comment" spellcheck="true">/***********************************加入新的用户**************************************/</span>                     people per<span class="token punctuation">;</span>                     per<span class="token punctuation">.</span>pip <span class="token operator">=</span> ip<span class="token punctuation">;</span>                     per<span class="token punctuation">.</span>pport <span class="token operator">=</span> port<span class="token punctuation">;</span>                     per<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"NULL"</span><span class="token punctuation">;</span>                     plist<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment" spellcheck="true">/***********************************************************************************/</span>                     <span class="token comment" spellcheck="true">//组包提示信息</span>                     QString temp <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"[%1%2]:进入聊天室"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>                     ui<span class="token operator">-</span><span class="token operator">></span>textEdit_online<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//增加显示当前所有的用户ip</span>                     ui<span class="token operator">-</span><span class="token operator">></span>textEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>                     temp <span class="token operator">=</span> MSG_flag<span class="token operator">+</span>temp<span class="token punctuation">;</span>                     <span class="token comment" spellcheck="true">//广播新进用户</span>                     <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                         socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token punctuation">}</span>                     <span class="token function">connect</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span><span class="token operator">&amp;</span>QTcpSocket<span class="token operator">::</span>readyRead<span class="token punctuation">,</span>                             <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                <span class="token punctuation">{</span>                                    <span class="token comment" spellcheck="true">//取内容</span>                                    QByteArray byteBuf <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    QString buf <span class="token operator">=</span>byteBuf<span class="token punctuation">;</span>                                    <span class="token keyword">if</span><span class="token punctuation">(</span>readyFile<span class="token punctuation">)</span><span class="token comment" spellcheck="true">//接收文件信息</span>                                    <span class="token punctuation">{</span>                                        qint64 len <span class="token operator">=</span> file2<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>                                        recvSize2 <span class="token operator">+</span><span class="token operator">=</span> len<span class="token punctuation">;</span>                                        <span class="token keyword">if</span><span class="token punctuation">(</span>recvSize2 <span class="token operator">==</span> fileSize2<span class="token punctuation">)</span>                                        <span class="token punctuation">{</span>                                           QString str <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"收到文件：[%1: %2KB]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileName2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileSize2<span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                           file2<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                           QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"文件信息"</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>                                           recvSize2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                                           readyFile <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                                        <span class="token punctuation">}</span>                                        <span class="token keyword">return</span><span class="token punctuation">;</span>                                    <span class="token punctuation">}</span>                                    <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>people_new<span class="token punctuation">)</span>                                    <span class="token punctuation">{</span>                                        <span class="token comment" spellcheck="true">//取出ip</span>                                        QString ip <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出ip</span>                                        <span class="token comment" spellcheck="true">//删除前缀</span>                                        ip <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                        qint16 port1 <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出端口</span>                                        QString thename<span class="token punctuation">;</span>                                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                             thename<span class="token punctuation">[</span>j<span class="token number">-1</span><span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                                        <span class="token punctuation">}</span>                                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>plist<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                            <span class="token keyword">if</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pip<span class="token operator">==</span>ip <span class="token operator">&amp;&amp;</span> plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pport <span class="token operator">==</span> port1<span class="token punctuation">)</span><span class="token punctuation">{</span>                                                plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> thename<span class="token punctuation">;</span>                                                                                     <span class="token comment" spellcheck="true">/**发给客户端*/</span>                                                QString thestring<span class="token punctuation">;</span>                                                thestring <span class="token operator">=</span> to_c_people_new <span class="token operator">+</span> plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pip <span class="token operator">+</span>sys_flag<span class="token operator">+</span> QString<span class="token operator">::</span><span class="token function">number</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pport<span class="token punctuation">)</span> <span class="token operator">+</span> sys_flag <span class="token operator">+</span> plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>                                                <span class="token comment" spellcheck="true">//P  ip  ! port ! name</span>                                                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                                    socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>thestring<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                <span class="token punctuation">}</span>                                                <span class="token keyword">return</span><span class="token punctuation">;</span>                                            <span class="token punctuation">}</span>                                        <span class="token punctuation">}</span>                                    <span class="token punctuation">}</span>                                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> sys_flag<span class="token punctuation">)</span>                                    <span class="token punctuation">{</span>                                        <span class="token comment" spellcheck="true">//信息：</span>                                        buf <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//去掉sys_flag</span>                                        QString ip <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出ip</span>                                        qint16 port <span class="token operator">=</span> socket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出端口号</span>                                        ip <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//删除ip前缀</span>                                        <span class="token comment" spellcheck="true">//文件反馈信息</span>                                        <span class="token keyword">if</span><span class="token punctuation">(</span>buf <span class="token operator">==</span> <span class="token string">"filedone"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                           QString thetemp <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span>ip<span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span><span class="token string">"文件已接收"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                           ui<span class="token operator">-</span><span class="token operator">></span>textEditFile<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>thetemp<span class="token punctuation">)</span><span class="token punctuation">;</span>                                        <span class="token punctuation">}</span>                                        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf <span class="token operator">==</span> <span class="token string">"Close"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//接收到用户端退出产生的反馈</span>                                        <span class="token punctuation">{</span>                                            <span class="token comment" spellcheck="true">/*******************************************************************************/</span>                                            <span class="token comment" spellcheck="true">/********************************用户离开****************************************/</span>                                            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>plist<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                                <span class="token keyword">if</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pip<span class="token operator">==</span>ip <span class="token operator">&amp;&amp;</span> plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pport <span class="token operator">==</span> port<span class="token punctuation">)</span><span class="token punctuation">{</span>                                                     <span class="token comment" spellcheck="true">/*发给客户端*/</span>                                                     QString str<span class="token punctuation">;</span>                                                     str <span class="token operator">=</span> to_c_people_del <span class="token operator">+</span> plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pip <span class="token operator">+</span><span class="token string">"!"</span> <span class="token operator">+</span> QString<span class="token operator">::</span><span class="token function">number</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pport<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                     <span class="token comment" spellcheck="true">//P  ip ! port</span>                                                     <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                                         socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                     <span class="token punctuation">}</span>                                                     plist<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                     <span class="token keyword">break</span><span class="token punctuation">;</span>                                                <span class="token punctuation">}</span>                                            <span class="token punctuation">}</span>                                            <span class="token comment" spellcheck="true">/********************************************************************************/</span>                                            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                                <span class="token keyword">int</span> iplen <span class="token operator">=</span> socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">;</span>                                                <span class="token keyword">if</span><span class="token punctuation">(</span>socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>iplen<span class="token punctuation">)</span><span class="token operator">==</span>ip<span class="token punctuation">)</span><span class="token punctuation">{</span>                                                    QString temp <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"[%1%2]:离开聊天室"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                    ui<span class="token operator">-</span><span class="token operator">></span>textEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                    temp <span class="token operator">=</span> <span class="token string">"MSG##"</span><span class="token operator">+</span>temp<span class="token punctuation">;</span>                                                    <span class="token comment" spellcheck="true">//广播出去</span>                                                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                                       socketarr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                    <span class="token punctuation">}</span>                                                    <span class="token comment" spellcheck="true">//删除</span>                                                    socketarr<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                    count<span class="token operator">--</span><span class="token punctuation">;</span>                                                    ui<span class="token operator">-</span><span class="token operator">></span>labelonline<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"当前在线人数："</span><span class="token operator">+</span>QString<span class="token operator">::</span><span class="token function">number</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                    <span class="token keyword">break</span><span class="token punctuation">;</span>                                               <span class="token punctuation">}</span>                                            <span class="token punctuation">}</span>                                            <span class="token comment" spellcheck="true">//在存在用户退出后，更新显示当前在线用户端ip</span>                                            <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>                                            <span class="token punctuation">{</span>                                               ui<span class="token operator">-</span><span class="token operator">></span>textEdit_online<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token punctuation">}</span>                                            <span class="token keyword">else</span>                                            <span class="token punctuation">{</span>                                                <span class="token comment" spellcheck="true">//显示首ip</span>                                                QString ip <span class="token operator">=</span> socketarr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出ip</span>                                                <span class="token comment" spellcheck="true">//删除前缀！</span>                                                ip <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                ui<span class="token operator">-</span><span class="token operator">></span>textEdit_online<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                <span class="token comment" spellcheck="true">//显示剩余ip</span>                                                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>                                                <span class="token punctuation">{</span>                                                QString ip <span class="token operator">=</span> socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出ip</span>                                                <span class="token comment" spellcheck="true">//删除前缀！</span>                                                ip <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                ui<span class="token operator">-</span><span class="token operator">></span>textEdit_online<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                <span class="token punctuation">}</span>                                            <span class="token punctuation">}</span>                                       <span class="token punctuation">}</span>                                    <span class="token punctuation">}</span>                                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">left</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> MSG_flag<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">//文本信息广播出去</span>                                    <span class="token punctuation">{</span>                                        QString temp1 <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>                                        ui<span class="token operator">-</span><span class="token operator">></span>textEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>temp1<span class="token punctuation">)</span><span class="token punctuation">;</span>                                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                            socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>temp1<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                        <span class="token punctuation">}</span>                                    <span class="token punctuation">}</span>                                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> head_flag<span class="token punctuation">)</span>                                    <span class="token punctuation">{</span>                                        fileName2 <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">"##"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                        fileSize2 <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">"##"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                        file2<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span><span class="token string">"../files/"</span><span class="token operator">+</span>fileName2<span class="token punctuation">)</span><span class="token punctuation">;</span>                                        <span class="token keyword">bool</span> isOk <span class="token operator">=</span> file2<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span> QFile<span class="token operator">::</span>WriteOnly<span class="token punctuation">)</span><span class="token punctuation">;</span>                                        ui<span class="token operator">-</span><span class="token operator">></span>textEditFile<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"收到文件："</span> <span class="token operator">+</span> file2<span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> isOk<span class="token punctuation">)</span>                                        <span class="token punctuation">{</span>                                            QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"文件信息"</span><span class="token punctuation">,</span><span class="token string">"服务器炸了QWQ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                        <span class="token punctuation">}</span>                                        readyFile <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                                    <span class="token punctuation">}</span>                                 <span class="token punctuation">}</span>                             <span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**************************************************************************************/</span>    <span class="token comment" spellcheck="true">//监听socket</span>    phonetcpserver <span class="token operator">=</span> <span class="token keyword">new</span> QTcpServer<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//receive</span>    <span class="token comment" spellcheck="true">//qint16 phoneport = ui->lineEditphone->text().toInt();</span>    phonetcpserver<span class="token operator">-</span><span class="token operator">></span><span class="token function">listen</span><span class="token punctuation">(</span>QHostAddress<span class="token operator">::</span>Any<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>ui<span class="token operator">-</span><span class="token operator">></span>lineEditphone<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">connect</span><span class="token punctuation">(</span>phonetcpserver<span class="token punctuation">,</span><span class="token operator">&amp;</span>QTcpServer<span class="token operator">::</span>newConnection<span class="token punctuation">,</span>           <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token punctuation">{</span>                QTcpSocket <span class="token operator">*</span> thesocket<span class="token punctuation">;</span>                thesocket <span class="token operator">=</span> phonetcpserver<span class="token operator">-</span><span class="token operator">></span><span class="token function">nextPendingConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//取出socket</span>                QString ip <span class="token operator">=</span> thesocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">int</span> port <span class="token operator">=</span> thesocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">peerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                ip <span class="token operator">=</span> ip<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>ip<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                ui<span class="token operator">-</span><span class="token operator">></span>textEdit<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"%1::%2-进入语音聊天室"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//connect 一定要写在newConnection内</span>                <span class="token function">connect</span><span class="token punctuation">(</span>thesocket<span class="token punctuation">,</span><span class="token function">SIGNAL</span><span class="token punctuation">(</span><span class="token function">readyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">SLOT</span><span class="token punctuation">(</span><span class="token function">readyReadSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//receiv  important</span>                phonetcpsocket<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>thesocket<span class="token punctuation">)</span><span class="token punctuation">;</span>                phone_count<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    QAudioFormat format<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//采样设置</span>    format<span class="token punctuation">.</span><span class="token function">setCodec</span><span class="token punctuation">(</span><span class="token string">"audio/pcm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//编码</span>    format<span class="token punctuation">.</span><span class="token function">setByteOrder</span><span class="token punctuation">(</span>QAudioFormat<span class="token operator">::</span>LittleEndian<span class="token punctuation">)</span><span class="token punctuation">;</span>    format<span class="token punctuation">.</span><span class="token function">setSampleRate</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//采样评率</span>    format<span class="token punctuation">.</span><span class="token function">setSampleSize</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//采样点数据位数</span>    format<span class="token punctuation">.</span><span class="token function">setSampleType</span><span class="token punctuation">(</span>QAudioFormat<span class="token operator">::</span>UnSignedInt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//返回采样点格式</span>    format<span class="token punctuation">.</span><span class="token function">setChannelCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//音频数据通道数</span>    input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QAudioInput</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//采用格式</span>    inputDevice <span class="token operator">=</span> input<span class="token operator">-</span><span class="token operator">></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//采集声音</span>    output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QAudioOutput</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    outputDevice <span class="token operator">=</span> output<span class="token operator">-</span><span class="token operator">></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//开始播放</span>    <span class="token function">connect</span><span class="token punctuation">(</span>inputDevice<span class="token punctuation">,</span><span class="token function">SIGNAL</span><span class="token punctuation">(</span><span class="token function">readyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">SLOT</span><span class="token punctuation">(</span><span class="token function">onReadyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**************************************************************************************/</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//选择文件按钮</span><span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">on_ButtonSelect_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    QString fPath <span class="token operator">=</span> QFileDialog<span class="token operator">::</span><span class="token function">getOpenFileName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"open"</span><span class="token punctuation">,</span><span class="token string">"../"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> fPath<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//如果选择文件路径有效</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//初始化</span>        fileName<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        fileSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//        sendSize = 0;</span>        filePath <span class="token operator">=</span> fPath<span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//获取文件信息</span>        QFileInfo <span class="token function">info</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>        fileName <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        fileSize <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span>    <span class="token punctuation">{</span>        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"选择文件路径出错 62"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">on_ButtonSend_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"on_ButtonSend_clicked"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//先发送文件头信息 文件名##文件大小</span>    QString subhead <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"%1##%2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileSize<span class="token punctuation">)</span><span class="token punctuation">;</span>    QString head <span class="token operator">=</span> head_flag <span class="token operator">+</span> subhead<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//(广播)发送头部信息</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        qint64 len <span class="token operator">=</span> socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>head<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//头部信息发送成功</span>        <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//发送真正的文件信息</span>            <span class="token comment" spellcheck="true">//防止TCP黏包，需要通过定时器延时20ms</span>            <span class="token comment" spellcheck="true">//文件传输计时器</span>            <span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>QTimer<span class="token operator">::</span>timeout<span class="token punctuation">,</span>                    <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">{</span>                        <span class="token comment" spellcheck="true">//关闭定时器</span>                        timer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">//发送文件</span>                        <span class="token function">sendData</span><span class="token punctuation">(</span>socketarr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                   <span class="token punctuation">)</span><span class="token punctuation">;</span>            timer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"头部信息发送失败 110"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">sendData</span><span class="token punctuation">(</span>QTcpSocket<span class="token operator">*</span> tcpSocket<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//指定文件名</span>    file<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//打开文件</span>    <span class="token keyword">bool</span> isOk <span class="token operator">=</span> file<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token operator">::</span>ReadOnly<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> isOk<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"只读方式打开文件失败 77"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//提示打开文件的路径</span>    ui<span class="token operator">-</span><span class="token operator">></span>textEditFile<span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> fileSize<span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    qint64 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">do</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//每次发送数据的单位（缓冲区大小）</span>        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//往文件中读数据</span>        len <span class="token operator">=</span> file<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//发送数据</span>        len <span class="token operator">=</span> tcpSocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//发送的数据需要累积</span>        sendSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> len<span class="token punctuation">;</span>        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setValue</span><span class="token punctuation">(</span>sendSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//判断是否发送文件完毕</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>sendSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> fileSize<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        sendSize<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//以免重复弹出完成提示</span>        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        file<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span>count<span class="token number">-1</span><span class="token punctuation">)</span>        QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"文件信息"</span><span class="token punctuation">,</span><span class="token string">"文件传输完毕"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/***********************************************************/</span><span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">onReadyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"onReadyRead"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/*----------------------------------send************************/</span>        video vp<span class="token punctuation">;</span>        <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>vp<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>vp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//读取音频</span><span class="token comment" spellcheck="true">//        vp.lens = inputDevice->read(vp.audiodata,1024);//读取音频</span><span class="token comment" spellcheck="true">//        for(int j=0;j&lt;phone_count;j++){</span><span class="token comment" spellcheck="true">//            phonetcpsocket[j]->write((const char*)&amp;vp,sizeof(vp));</span><span class="token comment" spellcheck="true">//        }</span><span class="token punctuation">}</span><span class="token keyword">void</span> ServerWidget<span class="token operator">::</span><span class="token function">readyReadSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"read"</span> <span class="token punctuation">;</span>        <span class="token keyword">int</span> size <span class="token operator">=</span> output<span class="token operator">-</span><span class="token operator">></span><span class="token function">periodSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        QByteArray bug<span class="token punctuation">;</span>        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"audio is being received..."</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>k<span class="token operator">&lt;</span>phone_count<span class="token punctuation">;</span>k<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            bug <span class="token operator">=</span> phonetcpsocket<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>bug<span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>phone_count<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">==</span> j<span class="token punctuation">)</span>  <span class="token keyword">continue</span><span class="token punctuation">;</span>                phonetcpsocket<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>bug<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h6 id="main-cpp"><a href="#main-cpp" class="headerlink" title="main.cpp"></a>main.cpp</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"serverwidget.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QApplication></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QStyleFactory></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFile></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    QApplication <span class="token function">a</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>    a<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>QStyleFactory<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"Fusion"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ServerWidget w<span class="token punctuation">;</span>    w<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h5 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端"></a>客户端</h5><p>注：pro文件添加</p><p><code>QT       += core gui network multimedia</code></p><h6 id="item-h"><a href="#item-h" class="headerlink" title="item.h"></a>item.h</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">ifndef</span> ITEM_H</span><span class="token macro property">#<span class="token directive keyword">define</span> ITEM_H</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QString></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QPushButton></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QWidget></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QHBoxLayout></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTextEdit></span></span><span class="token keyword">class</span> <span class="token class-name">ITEM</span><span class="token punctuation">{</span><span class="token keyword">private</span><span class="token operator">:</span>    QTextEdit <span class="token operator">*</span>msgbtn<span class="token punctuation">;</span>    QPushButton <span class="token operator">*</span>imgbtn<span class="token punctuation">;</span>    QWidget <span class="token operator">*</span>itw<span class="token punctuation">;</span>    QHBoxLayout <span class="token operator">*</span>hlayout<span class="token punctuation">;</span>    QString name<span class="token punctuation">;</span>    QString color<span class="token punctuation">;</span>    QString align<span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">fheight</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">fwidth</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">ITEM</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>name<span class="token punctuation">,</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>ali <span class="token punctuation">,</span> QWidget <span class="token operator">*</span>w<span class="token punctuation">,</span> QFont <span class="token operator">*</span>f<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token keyword">bool</span> vis<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">setMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">setStyle</span><span class="token punctuation">(</span>QFont <span class="token operator">*</span>f<span class="token punctuation">,</span> <span class="token keyword">double</span> r<span class="token punctuation">,</span> <span class="token keyword">double</span> w<span class="token punctuation">,</span> <span class="token keyword">double</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>    QWidget<span class="token operator">*</span> <span class="token function">Item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment" spellcheck="true">// ITEM_H</span></code></pre><h6 id="item-cpp"><a href="#item-cpp" class="headerlink" title="item.cpp"></a>item.cpp</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"item.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QVBoxLayout></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cmath></span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">int</span> ITEM<span class="token operator">::</span><span class="token function">fwidth</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span><span class="token punctuation">{</span>    QFont f <span class="token operator">=</span> msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    QFontMetrics <span class="token function">fm</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>    QStringList sl <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> ma<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> s<span class="token operator">:</span>sl<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>ma <span class="token operator">&lt;</span> fm<span class="token punctuation">.</span><span class="token function">boundingRect</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            ma <span class="token operator">=</span> fm<span class="token punctuation">.</span><span class="token function">boundingRect</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token function">min</span><span class="token punctuation">(</span>ma<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token operator">*</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> ITEM<span class="token operator">::</span><span class="token function">fheight</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> w<span class="token punctuation">)</span><span class="token punctuation">{</span>    QFont f <span class="token operator">=</span> msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    QFontMetrics <span class="token function">fm</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>    QStringList sl <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> res<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> h <span class="token operator">=</span> fm<span class="token punctuation">.</span><span class="token function">boundingRect</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> s<span class="token operator">:</span>sl<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        res <span class="token operator">+</span><span class="token operator">=</span> h<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>fm<span class="token punctuation">.</span><span class="token function">boundingRect</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">20</span> <span class="token operator">></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token operator">*</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            res <span class="token operator">+</span><span class="token operator">=</span> fm<span class="token punctuation">.</span><span class="token function">boundingRect</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token operator">*</span>w<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">*</span> h<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token function">max</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>ITEM<span class="token operator">::</span><span class="token function">ITEM</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>ali<span class="token punctuation">,</span> QWidget <span class="token operator">*</span>W<span class="token punctuation">,</span>           QFont <span class="token operator">*</span>f<span class="token punctuation">,</span> <span class="token keyword">bool</span> vis<span class="token punctuation">)</span><span class="token punctuation">{</span>    align <span class="token operator">=</span> ali<span class="token punctuation">;</span>    itw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QWidget</span><span class="token punctuation">(</span>W<span class="token punctuation">)</span><span class="token punctuation">;</span>    hlayout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QHBoxLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    itw<span class="token operator">-</span><span class="token operator">></span><span class="token function">setLayout</span><span class="token punctuation">(</span>hlayout<span class="token punctuation">)</span><span class="token punctuation">;</span>    QString btnMsg<span class="token operator">=</span><span class="token string">"  "</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> l<span class="token operator">=</span>msg<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>l<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            btnMsg<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"\n  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span>        <span class="token punctuation">{</span>            btnMsg<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    btnMsg<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    msgbtn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QTextEdit</span><span class="token punctuation">(</span>itw<span class="token punctuation">)</span><span class="token punctuation">;</span>    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span>btnMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setReadOnly</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    imgbtn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QPushButton</span><span class="token punctuation">(</span>itw<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>align <span class="token operator">==</span> <span class="token string">"left"</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addWidget</span><span class="token punctuation">(</span>imgbtn<span class="token punctuation">)</span><span class="token punctuation">;</span>        hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addWidget</span><span class="token punctuation">(</span>msgbtn<span class="token punctuation">)</span><span class="token punctuation">;</span>        hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addStretch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span>    <span class="token punctuation">{</span>        hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addStretch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addWidget</span><span class="token punctuation">(</span>msgbtn<span class="token punctuation">)</span><span class="token punctuation">;</span>        hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addWidget</span><span class="token punctuation">(</span>imgbtn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    imgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        f<span class="token operator">-</span><span class="token operator">></span><span class="token function">setFamily</span><span class="token punctuation">(</span><span class="token string">"微软雅黑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        f<span class="token operator">-</span><span class="token operator">></span><span class="token function">setPixelSize</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setFont</span><span class="token punctuation">(</span><span class="token operator">*</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>    QString alpha <span class="token operator">=</span> <span class="token string">"255"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>vis<span class="token punctuation">)</span>    alpha<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"刘朝日"</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">=</span> <span class="token string">"lzr.png"</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>color <span class="token operator">=</span> <span class="token string">"rgba(169,209,142,"</span><span class="token operator">+</span>alpha<span class="token operator">+</span><span class="token string">");"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"刘硕"</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">=</span> <span class="token string">"ls.png"</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>color <span class="token operator">=</span> <span class="token string">"rgba(255,217,102,"</span><span class="token operator">+</span>alpha<span class="token operator">+</span><span class="token string">");"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"曹文豪"</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">=</span> <span class="token string">"cwh.png"</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>color <span class="token operator">=</span> <span class="token string">"rgba(157,195,230,"</span><span class="token operator">+</span>alpha<span class="token operator">+</span><span class="token string">");"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"刘涵准"</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">=</span> <span class="token string">"lhz.png"</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>color <span class="token operator">=</span> <span class="token string">"rgba(102,204,255,"</span><span class="token operator">+</span>alpha<span class="token operator">+</span><span class="token string">");"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token string">"雷艳"</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">=</span> <span class="token string">"ly.png"</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>color <span class="token operator">=</span> <span class="token string">"rgba(252,209,216,"</span><span class="token operator">+</span>alpha<span class="token operator">+</span><span class="token string">");"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    imgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setFixedSize</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    imgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"border-image:url(../src/"</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">+</span><span class="token string">");"</span>                          <span class="token string">"border-radius:30px;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color:"</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>color <span class="token operator">+</span>                          <span class="token string">"border-radius: 5px;"</span>                          <span class="token punctuation">)</span><span class="token punctuation">;</span>    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setMinimumHeight</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">setMargin</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> ITEM<span class="token operator">::</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span><span class="token punctuation">{</span>    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setFixedSize</span><span class="token punctuation">(</span><span class="token function">fwidth</span><span class="token punctuation">(</span>msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toPlainText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">,</span>                         <span class="token function">fheight</span><span class="token punctuation">(</span>msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toPlainText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    itw<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">1.3</span><span class="token operator">*</span>imgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">1.3</span><span class="token operator">*</span>msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> ITEM<span class="token operator">::</span><span class="token function">setMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">{</span>    msgbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>QWidget<span class="token operator">*</span> ITEM<span class="token operator">::</span><span class="token function">Item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> itw<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h6 id="clientwidget-h"><a href="#clientwidget-h" class="headerlink" title="clientwidget.h"></a>clientwidget.h</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">ifndef</span> CLIENTWIDGET_H</span><span class="token macro property">#<span class="token directive keyword">define</span> CLIENTWIDGET_H</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QWidget></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTcpSocket></span></span><span class="token comment" spellcheck="true">//音频信息</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QDialog></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QtNetwork/QUdpSocket></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudio></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudioInput></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAudioOutput></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QIODevice></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFile></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QDebug></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QMessageBox></span></span><span class="token comment" spellcheck="true">//弹出对话框</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QPushButton></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTextEdit></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QVector></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QVBoxLayout></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTimer></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"item.h"</span></span>QT_BEGIN_NAMESPACE<span class="token keyword">namespace</span> Ui <span class="token punctuation">{</span> <span class="token keyword">class</span> <span class="token class-name">ClientWidget</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>QT_END_NAMESPACE<span class="token keyword">const</span> <span class="token keyword">char</span> file_flag <span class="token operator">=</span> <span class="token string">'F'</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span> head_flag <span class="token operator">=</span> <span class="token string">'H'</span><span class="token punctuation">;</span><span class="token keyword">const</span> QString MSG_flag <span class="token operator">=</span> <span class="token string">"MSG##"</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span> sys_flag <span class="token operator">=</span> <span class="token string">'!'</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span> people_new <span class="token operator">=</span> <span class="token string">'P'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//新的用户到来</span><span class="token keyword">const</span> <span class="token keyword">char</span> people_del <span class="token operator">=</span> <span class="token string">'D'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//新的用户离开</span><span class="token comment" spellcheck="true">/***********************************************/</span><span class="token keyword">struct</span> people<span class="token punctuation">{</span>    QString pip<span class="token punctuation">;</span>    QString name<span class="token punctuation">;</span>    QString pport<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">/***********************************************/</span><span class="token keyword">class</span> <span class="token class-name">ClientWidget</span> <span class="token operator">:</span> <span class="token keyword">public</span> QWidget<span class="token punctuation">{</span>    Q_OBJECT<span class="token keyword">public</span><span class="token operator">:</span>    <span class="token function">ClientWidget</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">~</span><span class="token function">ClientWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">on_pushButtonenter_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">private</span> slots<span class="token operator">:</span>    <span class="token keyword">void</span> <span class="token function">on_pushButtonsend_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">on_pushButtonclose_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">on_selectButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">on_sendButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">slider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">readyReadSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">onReadyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">private</span><span class="token operator">:</span>    Ui<span class="token operator">::</span>ClientWidget <span class="token operator">*</span>ui<span class="token punctuation">;</span>    QVBoxLayout <span class="token operator">*</span>vlayout<span class="token punctuation">;</span>    QWidget <span class="token operator">*</span>login<span class="token punctuation">;</span>    QWidget <span class="token operator">*</span>upload<span class="token punctuation">;</span>    QString name<span class="token punctuation">,</span> ip<span class="token punctuation">;</span>    <span class="token keyword">int</span> port<span class="token punctuation">;</span>    QVector<span class="token operator">&lt;</span>ITEM <span class="token operator">*</span><span class="token operator">></span> items<span class="token punctuation">;</span>    <span class="token keyword">int</span> phone_port<span class="token punctuation">;</span>    QVector<span class="token operator">&lt;</span>people<span class="token operator">></span> plist<span class="token punctuation">;</span>    QTcpSocket <span class="token operator">*</span>tcpsocket<span class="token punctuation">;</span>    QFile  file<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件对象</span>    QString fileName<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件名字</span>    qint64 fileSize<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件大小</span>    qint64 recvSize<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//已接收的文件大小</span>    <span class="token comment" spellcheck="true">//客户端作为发送端</span>    QFile  file2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件对象</span>    QString fileName2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件名字</span>    qint64 fileSize2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件大小</span>    qint64 sendSize2<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//已发送的文件大小</span>    QTimer timer<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//定时器  黏包  头部----文件体</span>    QMessageBox msgBox<span class="token punctuation">;</span>    <span class="token keyword">bool</span> phone_on<span class="token punctuation">;</span>    <span class="token keyword">bool</span> fileflag<span class="token punctuation">;</span>    <span class="token keyword">bool</span> readyFile<span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">pushMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>alig<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">updateList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//音频</span>    QTcpSocket <span class="token operator">*</span>phone_tcpsocket<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//out</span>    QAudioOutput <span class="token operator">*</span>output<span class="token punctuation">;</span>    QIODevice <span class="token operator">*</span>outputDevice<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//in</span>    QAudioInput <span class="token operator">*</span>input<span class="token punctuation">;</span>    QIODevice <span class="token operator">*</span>inputDevice<span class="token punctuation">;</span>    <span class="token keyword">bool</span> linktophone<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token keyword">protected</span><span class="token operator">:</span>    <span class="token keyword">void</span> <span class="token function">sendData</span><span class="token punctuation">(</span>QTcpSocket<span class="token operator">*</span> tcpSocket<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//发送文件数据</span>    <span class="token keyword">void</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>signals<span class="token operator">:</span>    <span class="token keyword">void</span> <span class="token function">logined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">struct</span> video<span class="token punctuation">{</span>        <span class="token keyword">char</span> audiodata<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> lens<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment" spellcheck="true">// CLIENTWIDGET_H</span></code></pre><h6 id="clientwidget-cpp"><a href="#clientwidget-cpp" class="headerlink" title="clientwidget.cpp"></a>clientwidget.cpp</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clientwidget.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ui_clientwidget.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QHostAddress></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFileDialog></span></span><span class="token comment" spellcheck="true">//选择文件的对话框</span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QPainter></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QInputDialog></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QWidget></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QScrollArea></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QFont></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QPushButton></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QTextEdit></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QAbstractSlider></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QScrollBar></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QLineEdit></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QDebug></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QProgressBar></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QRect></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"item.h"</span></span>ClientWidget<span class="token operator">::</span><span class="token function">ClientWidget</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span>    <span class="token operator">:</span> <span class="token function">QWidget</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>    <span class="token punctuation">,</span> <span class="token function">ui</span><span class="token punctuation">(</span><span class="token keyword">new</span> Ui<span class="token operator">::</span>ClientWidget<span class="token punctuation">)</span><span class="token punctuation">{</span>    phone_tcpsocket <span class="token operator">=</span> <span class="token keyword">new</span> QTcpSocket<span class="token punctuation">;</span>    ip<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>    port <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span><span class="token function">setupUi</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>sendButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    readyFile <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    phone_on <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token function">setWindowTitle</span><span class="token punctuation">(</span><span class="token string">"计算机网络点点通信实验"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">1350</span><span class="token punctuation">,</span> <span class="token number">850</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    tcpsocket <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>    tcpsocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QTcpSocket</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ClientWidget<span class="token operator">::</span>close<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ClientWidget<span class="token operator">::</span>on_pushButtonclose_clicked<span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>scrollArea<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color:rgba(255,255,255,0)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>input<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color:rgba(255,255,0,20);"</span>                             <span class="token string">"border-style:solid;"</span>                             <span class="token string">"border-radius:5px;"</span>                             <span class="token string">"border-color:yellow;"</span>                             <span class="token string">"border-width:2.5px;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    QFont f<span class="token punctuation">;</span>    f<span class="token punctuation">.</span><span class="token function">setFamily</span><span class="token punctuation">(</span><span class="token string">"微软雅黑"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    f<span class="token punctuation">.</span><span class="token function">setPixelSize</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>input<span class="token operator">-</span><span class="token operator">></span><span class="token function">setFont</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>    vlayout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QVBoxLayout</span><span class="token punctuation">(</span>ui<span class="token operator">-</span><span class="token operator">></span>scrollAreaWidgetContents<span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>scrollAreaWidgetContents<span class="token operator">-</span><span class="token operator">></span><span class="token function">setLayout</span><span class="token punctuation">(</span>vlayout<span class="token punctuation">)</span><span class="token punctuation">;</span>    vlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">setDirection</span><span class="token punctuation">(</span>QBoxLayout<span class="token operator">::</span>BottomToTop<span class="token punctuation">)</span><span class="token punctuation">;</span>    vlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">addStretch</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">connect</span><span class="token punctuation">(</span>ui<span class="token operator">-</span><span class="token operator">></span>scrollArea<span class="token operator">-</span><span class="token operator">></span><span class="token function">verticalScrollBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>QAbstractSlider<span class="token operator">::</span>rangeChanged<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ClientWidget<span class="token operator">::</span>slider<span class="token punctuation">)</span><span class="token punctuation">;</span>    upload <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    login <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    login<span class="token operator">-</span><span class="token operator">></span><span class="token function">setWindowTitle</span><span class="token punctuation">(</span><span class="token string">"SOCKET 通信"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    login<span class="token operator">-</span><span class="token operator">></span><span class="token function">setFixedSize</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    QPushButton <span class="token operator">*</span>namelabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QPushButton</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>    namelabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"用户名"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    namelabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    QLineEdit <span class="token operator">*</span>name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLineEdit</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>    name<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    QPushButton <span class="token operator">*</span>iplabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QPushButton</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>    iplabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"ip地址"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    iplabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    QLineEdit <span class="token operator">*</span>ip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLineEdit</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>    ip<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    QPushButton <span class="token operator">*</span>portlabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QPushButton</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>    portlabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"port"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    portlabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    QLineEdit <span class="token operator">*</span>port <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLineEdit</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>    port<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    QPushButton <span class="token operator">*</span>phoneportlabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QPushButton</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>    phoneportlabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"p_port"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    phoneportlabel<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    QLineEdit <span class="token operator">*</span>phoneport <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QLineEdit</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>    phoneport<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    phoneport<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"10085"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    QPushButton <span class="token operator">*</span>loginbtn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QPushButton</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>    loginbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    loginbtn<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">270</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    login<span class="token operator">-</span><span class="token operator">></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">connect</span><span class="token punctuation">(</span>loginbtn<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QPushButton<span class="token operator">::</span>pressed<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">,</span> ip<span class="token punctuation">,</span> port<span class="token punctuation">,</span> name<span class="token punctuation">,</span> phoneport<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">=</span> name<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>ip <span class="token operator">=</span> ip<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>port <span class="token operator">=</span> port<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>phone_port <span class="token operator">=</span> phoneport<span class="token operator">-</span><span class="token operator">></span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">!=</span> <span class="token string">"刘朝日"</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">!=</span> <span class="token string">"曹文豪"</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">!=</span> <span class="token string">"刘硕"</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">!=</span> <span class="token string">"刘涵准"</span>                <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>name <span class="token operator">!=</span> <span class="token string">"雷艳"</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">on_pushButtonenter_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ClientWidget<span class="token operator">::</span>logined<span class="token punctuation">,</span> login<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QWidget<span class="token operator">::</span>close<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setMinimumSize</span><span class="token punctuation">(</span><span class="token number">810</span><span class="token punctuation">,</span> <span class="token number">510</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setMaximumSize</span><span class="token punctuation">(</span><span class="token number">1350</span><span class="token punctuation">,</span> <span class="token number">850</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>onlineListW<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"background-color:rgba(197,232,211,125);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>selectButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"QPushButton{border-image:url(../src/upload.png);"</span>                                    <span class="token string">"border-radius:40px;}"</span>                                    <span class="token string">"QPushButton:hover{border-image:url(../src/upload_hover.png);"</span>                                    <span class="token string">"border-radius:40px;}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>phoneButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"QPushButton{border-image:url(../src/phone_off.png);"</span>                                     <span class="token string">"border-radius:40px;}"</span>                                   <span class="token string">"QPushButton:hover{border-image:url(../src/phone_hover.png);"</span>                                   <span class="token string">"border-radius:40px;}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">connect</span><span class="token punctuation">(</span>ui<span class="token operator">-</span><span class="token operator">></span>phoneButton<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QPushButton<span class="token operator">::</span>pressed<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>phone_on<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            ui<span class="token operator">-</span><span class="token operator">></span>phoneButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"QPushButton{border-image:url(../src/phone_off.png);"</span>                                             <span class="token string">"border-radius:40px;}"</span>                                           <span class="token string">"QPushButton:hover{border-image:url(../src/phone_hover.png);"</span>                                           <span class="token string">"border-radius:40px;}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            phone_tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span>        <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//获取服务器的ip和端口</span>            <span class="token comment" spellcheck="true">//主动和服务器连接</span>            phone_tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">connectToHost</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>ip<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>phone_port<span class="token punctuation">)</span><span class="token punctuation">;</span>            ui<span class="token operator">-</span><span class="token operator">></span>phoneButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setStyleSheet</span><span class="token punctuation">(</span><span class="token string">"QPushButton{border-image:url(../src/phone_on.png);"</span>                                             <span class="token string">"border-radius:40px;}"</span>                                           <span class="token string">"QPushButton:hover{border-image:url(../src/phone_onhover.png);"</span>                                           <span class="token string">"border-radius:40px;}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        phone_on <span class="token operator">=</span> <span class="token operator">!</span>phone_on<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//音频信息</span><span class="token comment" spellcheck="true">/*****************************************************************/</span>        <span class="token function">connect</span><span class="token punctuation">(</span>phone_tcpsocket<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QTcpSocket<span class="token operator">::</span>connected<span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//提示连接成功</span><span class="token comment" spellcheck="true">//            ui->textEdit->append("已经加入语音群聊");</span>        <span class="token punctuation">}</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">connect</span><span class="token punctuation">(</span>phone_tcpsocket<span class="token punctuation">,</span><span class="token function">SIGNAL</span><span class="token punctuation">(</span><span class="token function">readyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">SLOT</span><span class="token punctuation">(</span><span class="token function">readyReadSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//设置参数</span>        QAudioFormat format<span class="token punctuation">;</span>        format<span class="token punctuation">.</span><span class="token function">setSampleRate</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        format<span class="token punctuation">.</span><span class="token function">setChannelCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        format<span class="token punctuation">.</span><span class="token function">setSampleSize</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        format<span class="token punctuation">.</span><span class="token function">setCodec</span><span class="token punctuation">(</span><span class="token string">"audio/pcm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        format<span class="token punctuation">.</span><span class="token function">setSampleType</span><span class="token punctuation">(</span>QAudioFormat<span class="token operator">::</span>SignedInt<span class="token punctuation">)</span><span class="token punctuation">;</span>        format<span class="token punctuation">.</span><span class="token function">setByteOrder</span><span class="token punctuation">(</span>QAudioFormat<span class="token operator">::</span>LittleEndian<span class="token punctuation">)</span><span class="token punctuation">;</span>        output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QAudioOutput</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        outputDevice <span class="token operator">=</span> output<span class="token operator">-</span><span class="token operator">></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//开始播放</span>        input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QAudioInput</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        inputDevice <span class="token operator">=</span> input<span class="token operator">-</span><span class="token operator">></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">connect</span><span class="token punctuation">(</span>inputDevice<span class="token punctuation">,</span><span class="token function">SIGNAL</span><span class="token punctuation">(</span><span class="token function">readyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">SLOT</span><span class="token punctuation">(</span><span class="token function">onReadyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//send</span>        <span class="token comment" spellcheck="true">//音频信息</span><span class="token comment" spellcheck="true">/*****************************************************************/</span><span class="token punctuation">}</span><span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">paintEvent</span><span class="token punctuation">(</span>QPaintEvent <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    QPainter <span class="token function">p</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    p<span class="token punctuation">.</span><span class="token function">drawPixmap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">QPixmap</span><span class="token punctuation">(</span><span class="token string">"../src/background.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>scrollArea<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.75</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.87</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>scrollArea<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.25</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>input<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.585</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.09</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>input<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.25</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.90</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>pushButtonsend<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.85</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.90</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>pushButtonsend<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.14</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.04</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>pushButtonclose<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.85</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>pushButtonclose<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.14</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.04</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>scrollAreaWidgetContents<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.75</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.87</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>onlineListW<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.25</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.87</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>onlineListW<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>selectButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.09</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.09</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>phoneButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.09</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0.09</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>selectButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.03</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.90</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>phoneButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.18</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token number">0.90</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">slider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    ui<span class="token operator">-</span><span class="token operator">></span>scrollArea<span class="token operator">-</span><span class="token operator">></span><span class="token function">verticalScrollBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setValue</span><span class="token punctuation">(</span>ui<span class="token operator">-</span><span class="token operator">></span>scrollArea<span class="token operator">-</span><span class="token operator">></span><span class="token function">verticalScrollBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">maximumHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">updateList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>ClientWidget<span class="token operator">::</span><span class="token operator">~</span><span class="token function">ClientWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">delete</span> ui<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">pushMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> QString <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token keyword">const</span> QString <span class="token operator">&amp;</span>ali<span class="token punctuation">)</span><span class="token punctuation">{</span>    ITEM <span class="token operator">*</span>it <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ITEM</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> name<span class="token punctuation">,</span> ali<span class="token punctuation">,</span> ui<span class="token operator">-</span><span class="token operator">></span>scrollAreaWidgetContents<span class="token punctuation">)</span><span class="token punctuation">;</span>    vlayout<span class="token operator">-</span><span class="token operator">></span><span class="token function">insertWidget</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> it<span class="token operator">-</span><span class="token operator">></span><span class="token function">Item</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    items<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>    it<span class="token operator">-</span><span class="token operator">></span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token operator">*</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token operator">*</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">on_pushButtonenter_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//获取服务器的ip和端口</span>    QString ip <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>ip<span class="token punctuation">;</span>    qint16 port <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span>port<span class="token punctuation">;</span>    tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">connectToHost</span><span class="token punctuation">(</span><span class="token function">QHostAddress</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">,</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">connect</span><span class="token punctuation">(</span>tcpsocket<span class="token punctuation">,</span><span class="token operator">&amp;</span>QTcpSocket<span class="token operator">::</span>connected<span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span>                QString str <span class="token operator">=</span> people_new<span class="token operator">+</span>name<span class="token punctuation">;</span>                tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                emit <span class="token function">logined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">connect</span><span class="token punctuation">(</span>tcpsocket<span class="token punctuation">,</span><span class="token operator">&amp;</span>QTcpSocket<span class="token operator">::</span>readyRead<span class="token punctuation">,</span>            <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">//取出接收的内容</span>                    QByteArray byteBuf <span class="token operator">=</span> tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>byteBuf <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span>   <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//防止空串bug</span>                    QString buf <span class="token operator">=</span> byteBuf<span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>readyFile<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">//传过来的是文件</span>                    <span class="token punctuation">{</span>                        qint64 len <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>byteBuf<span class="token punctuation">)</span><span class="token punctuation">;</span>                        recvSize <span class="token operator">+</span><span class="token operator">=</span> len<span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>recvSize <span class="token operator">==</span> fileSize<span class="token punctuation">)</span>                        <span class="token punctuation">{</span>                            QString done<span class="token punctuation">;</span>done<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>sys_flag<span class="token punctuation">)</span><span class="token punctuation">;</span>done<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"filedone"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>done<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            QString str <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"收到文件：[%1: %2KB]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileSize<span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            readyFile <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                            QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"文件信息"</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> head_flag<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//接收头</span>                    <span class="token punctuation">{</span>                        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>buf<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>                        buf <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">//解析头部信息 QString buf = "hello##1024"</span>                        <span class="token comment" spellcheck="true">//初始化</span>                        fileName <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">"##"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        fileSize <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">"##"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        recvSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                        <span class="token comment" spellcheck="true">//打开文件</span><span class="token comment" spellcheck="true">//                        QString filePath1 = QFileDialog::getExistingDirectory(this,"open","./");</span><span class="token comment" spellcheck="true">//                        qDebug()&lt;&lt;buf&lt;&lt;" "&lt;&lt;isMSG&lt;&lt;endl;</span><span class="token comment" spellcheck="true">//                        QString filePath1 = fileName;</span>                        file<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//"D:\book\\"+</span>                        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"收到文件："</span> <span class="token operator">+</span> file<span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>                        <span class="token keyword">bool</span> isOk <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token operator">::</span>WriteOnly<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> isOk<span class="token punctuation">)</span>                        <span class="token punctuation">{</span>                            QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"文件信息"</span><span class="token punctuation">,</span><span class="token string">"服务器炸了QWQ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        readyFile <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>people_new<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//P  ip  ! port ! name</span>                        QString theip <span class="token punctuation">;</span>                        QString theport<span class="token punctuation">;</span>                        QString thename<span class="token punctuation">;</span>                        <span class="token keyword">int</span> thej<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>                        <span class="token keyword">int</span> num<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>thej<span class="token operator">&lt;</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thej<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>thej<span class="token punctuation">]</span><span class="token operator">==</span>sys_flag<span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>                            theip<span class="token punctuation">[</span>num<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>thej<span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        thej<span class="token operator">++</span><span class="token punctuation">;</span>                        num<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>thej<span class="token operator">&lt;</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thej<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>thej<span class="token punctuation">]</span><span class="token operator">==</span>sys_flag<span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>                            theport<span class="token punctuation">[</span>num<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>thej<span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        thej<span class="token operator">++</span><span class="token punctuation">;</span>                        num<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>thej<span class="token operator">&lt;</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thej<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            thename<span class="token punctuation">[</span>num<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>thej<span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        people thep<span class="token punctuation">;</span>                        thep<span class="token punctuation">.</span>pip <span class="token operator">=</span> theip<span class="token punctuation">;</span>                        thep<span class="token punctuation">.</span>name <span class="token operator">=</span> thename<span class="token punctuation">;</span>                        thep<span class="token punctuation">.</span>pport <span class="token operator">=</span> theport<span class="token punctuation">;</span>                        plist<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>thep<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">return</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>people_del<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//D ip ! port</span>                        QString theip <span class="token punctuation">;</span>                        QString theport<span class="token punctuation">;</span>                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">==</span>sys_flag<span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>                            theip<span class="token punctuation">[</span>j<span class="token number">-1</span><span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        <span class="token keyword">bool</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                        <span class="token keyword">int</span> num<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>buf<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">!=</span>sys_flag<span class="token punctuation">)</span><span class="token keyword">continue</span><span class="token punctuation">;</span>                            <span class="token keyword">else</span> <span class="token punctuation">{</span>                                flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                                <span class="token keyword">continue</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span>                            <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>                                theport<span class="token punctuation">[</span>num<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                                num<span class="token operator">++</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>plist<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                            <span class="token keyword">if</span><span class="token punctuation">(</span>plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pip <span class="token operator">==</span> theip <span class="token operator">&amp;&amp;</span> plist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pport <span class="token operator">==</span> theport<span class="token punctuation">)</span><span class="token punctuation">{</span>                                plist<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token keyword">return</span><span class="token punctuation">;</span>                            <span class="token punctuation">}</span>                        <span class="token punctuation">}</span>                        <span class="token keyword">return</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">left</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> MSG_flag<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">//传过来的是信息</span>                    <span class="token punctuation">{</span>                        buf <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"进入聊天室"</span><span class="token punctuation">)</span>                        <span class="token punctuation">{</span>                        <span class="token punctuation">}</span>                        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"离开聊天室"</span><span class="token punctuation">)</span>                        <span class="token punctuation">{</span>                        <span class="token punctuation">}</span>                        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>name <span class="token operator">!=</span> buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                        <span class="token punctuation">{</span>                            <span class="token function">pushMsg</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>buf<span class="token punctuation">.</span><span class="token function">section</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token string">"left"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">on_pushButtonsend_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//获取内容</span>    QString str <span class="token operator">=</span> ui<span class="token operator">-</span><span class="token operator">></span>input<span class="token operator">-</span><span class="token operator">></span><span class="token function">document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toPlainText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>str <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"提示"</span><span class="token punctuation">,</span><span class="token string">"发送消息不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">pushMsg</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token string">"right"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    str <span class="token operator">=</span> MSG_flag<span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span>str<span class="token punctuation">;</span>    tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ui<span class="token operator">-</span><span class="token operator">></span>input<span class="token operator">-</span><span class="token operator">></span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">on_pushButtonclose_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//关闭</span>    QString str<span class="token punctuation">;</span>    str<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>sys_flag<span class="token punctuation">)</span><span class="token punctuation">;</span>    str<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"Close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">disconnectFromHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//选择文件按钮</span><span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">on_selectButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    QString filePath2 <span class="token operator">=</span> QFileDialog<span class="token operator">::</span><span class="token function">getOpenFileName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"open"</span><span class="token punctuation">,</span><span class="token string">"../"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> filePath2<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//如果选择文件路径有效</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//初始化</span>        fileName2<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        fileSize2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        sendSize2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//获取文件信息</span>        QFileInfo <span class="token function">info</span><span class="token punctuation">(</span>filePath2<span class="token punctuation">)</span><span class="token punctuation">;</span>        fileName2 <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        fileSize2 <span class="token operator">=</span> info<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//只读方式打开文件</span>        <span class="token comment" spellcheck="true">//指定文件名</span>        file2<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span>filePath2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//打开文件</span>        <span class="token keyword">bool</span> isOk <span class="token operator">=</span> file2<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token operator">::</span>ReadOnly<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">==</span> isOk<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"只读方式打开文件失败 77"</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        upload<span class="token operator">-</span><span class="token operator">></span><span class="token function">setWindowTitle</span><span class="token punctuation">(</span><span class="token string">"文件上传"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> fileSize2<span class="token punctuation">)</span><span class="token punctuation">;</span>        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setParent</span><span class="token punctuation">(</span>upload<span class="token punctuation">)</span><span class="token punctuation">;</span>        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ui<span class="token operator">-</span><span class="token operator">></span>sendButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setParent</span><span class="token punctuation">(</span>upload<span class="token punctuation">)</span><span class="token punctuation">;</span>        ui<span class="token operator">-</span><span class="token operator">></span>sendButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ui<span class="token operator">-</span><span class="token operator">></span>sendButton<span class="token operator">-</span><span class="token operator">></span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        upload<span class="token operator">-</span><span class="token operator">></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span>    <span class="token punctuation">{</span>        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"选择文件路径出错 62"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//反向发送按钮</span><span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">on_sendButton_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"on_sendButton_clicked"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//先发送文件头信息 文件名##文件大小</span>    QString head <span class="token operator">=</span> head_flag <span class="token operator">+</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"##%1##%2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileName2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>fileSize2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>head<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//发送头部信息</span>    qint64 len <span class="token operator">=</span> tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>head<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//头部信息发送成功</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//发送真正的文件信息</span>        <span class="token comment" spellcheck="true">//防止TCP黏包，需要通过定时器延时20ms</span>        timer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//文件传输计时器</span>        <span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timer<span class="token punctuation">,</span><span class="token operator">&amp;</span>QTimer<span class="token operator">::</span>timeout<span class="token punctuation">,</span>                <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">//关闭定时器</span>                    timer<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment" spellcheck="true">//发送文件</span>                    <span class="token function">sendData</span><span class="token punctuation">(</span>tcpsocket<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"头部信息发送失败 110"</span><span class="token punctuation">;</span>        file2<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//发送文件</span><span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">sendData</span><span class="token punctuation">(</span>QTcpSocket<span class="token operator">*</span> tcpSocket<span class="token punctuation">)</span><span class="token punctuation">{</span>    qint64 len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">do</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//每次发送数据的单位（缓冲区大小）</span>        <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//往文件中读数据</span>        len <span class="token operator">=</span> file2<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        len <span class="token operator">=</span> tcpSocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//发送的数据需要累积</span>        sendSize2 <span class="token operator">+</span><span class="token operator">=</span> len<span class="token punctuation">;</span>        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">setValue</span><span class="token punctuation">(</span>sendSize2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">while</span><span class="token punctuation">(</span>len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//判断是否发送文件完毕</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>sendSize2 <span class="token operator">==</span> fileSize2<span class="token punctuation">)</span>    <span class="token punctuation">{</span>        QMessageBox<span class="token operator">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"transport"</span><span class="token punctuation">,</span> <span class="token string">"文件发送完毕！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ui<span class="token operator">-</span><span class="token operator">></span>progressBar<span class="token operator">-</span><span class="token operator">></span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sendSize2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//以免重复弹出完成提示</span>    <span class="token punctuation">}</span>    file2<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    upload<span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/*****************************音频信息*************************/</span><span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">readyReadSlot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">int</span> size <span class="token operator">=</span> output<span class="token operator">-</span><span class="token operator">></span><span class="token function">periodSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        QByteArray bug<span class="token punctuation">;</span>        video vp<span class="token punctuation">;</span>        <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>vp<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>vp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//监听音频   并且传送</span>        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"我在接收呢"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>        bug <span class="token operator">=</span> phone_tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        outputDevice<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span>bug<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> ClientWidget<span class="token operator">::</span><span class="token function">onReadyRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//send</span><span class="token punctuation">{</span>        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"It's sending audio!"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>        video vp<span class="token punctuation">;</span>        <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>vp<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>vp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//读取音频</span>        vp<span class="token punctuation">.</span>lens <span class="token operator">=</span> inputDevice<span class="token operator">-</span><span class="token operator">></span><span class="token function">read</span><span class="token punctuation">(</span>vp<span class="token punctuation">.</span>audiodata<span class="token punctuation">,</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        phone_tcpsocket<span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>vp<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>vp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//先给服务发送(接收文件完成的信息)</span><span class="token punctuation">}</span></code></pre><h6 id="main-cpp-1"><a href="#main-cpp-1" class="headerlink" title="main.cpp"></a>main.cpp</h6><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"clientwidget.h"</span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QApplication></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QStyleFactory></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;QWidget></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    QApplication <span class="token function">a</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>    a<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>QStyleFactory<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"Fusion"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    ClientWidget w<span class="token punctuation">;</span>    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h4 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h4><ul><li>仅仅支持同一局域网内通讯</li><li>若连接外网（比如河北的物理机）可以使用花生壳（免费1G）等端口映射工具；</li></ul><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;[toc]&lt;/p&gt;
&lt;h4 id=&quot;实现内容&quot;&gt;&lt;a href=&quot;#实现内容&quot; class=&quot;headerlink&quot; title=&quot;实现内容&quot;&gt;&lt;/a&gt;实现内容&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;多人聊天室&lt;/li&gt;
&lt;li&gt;文件传输&lt;/li&gt;
&lt;li&gt;多人语音聊天室&lt;/li&gt;
&lt;
      
    
    </summary>
    
    
    
      <category term="QT" scheme="http://LiuShuo1999.github.io/tags/QT/"/>
    
      <category term="计网课设" scheme="http://LiuShuo1999.github.io/tags/%E8%AE%A1%E7%BD%91%E8%AF%BE%E8%AE%BE/"/>
    
      <category term="TCP通讯" scheme="http://LiuShuo1999.github.io/tags/TCP%E9%80%9A%E8%AE%AF/"/>
    
  </entry>
  
  <entry>
    <title>scanf 踩坑</title>
    <link href="http://liushuo1999.github.io/2020/05/14/scanf-%E8%B8%A9%E5%9D%91/"/>
    <id>http://liushuo1999.github.io/2020/05/14/scanf-%E8%B8%A9%E5%9D%91/</id>
    <published>2020-05-14T09:36:32.000Z</published>
    <updated>2020-05-14T09:37:24.589Z</updated>
    
    <content type="html"><![CDATA[<p>scanf(“%c”,ch);这样会读入空格和回车符<br><img src="https://img-blog.csdnimg.cn/20200514173404162.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU1Mjk2MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">以下两种写法可以忽略回车符和空格</p><pre class=" language-cpp"><code class="language-cpp">cin<span class="token operator">>></span>ch<span class="token punctuation">;</span><span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">" %c"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;scanf(“%c”,ch);这样会读入空格和回车符&lt;br&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20200514173404162.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5n
      
    
    </summary>
    
    
    
      <category term="程序设计" scheme="http://LiuShuo1999.github.io/tags/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="错题" scheme="http://LiuShuo1999.github.io/tags/%E9%94%99%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>位运算</title>
    <link href="http://liushuo1999.github.io/2020/05/13/%E4%BD%8D%E8%BF%90%E7%AE%97/"/>
    <id>http://liushuo1999.github.io/2020/05/13/%E4%BD%8D%E8%BF%90%E7%AE%97/</id>
    <published>2020-05-13T13:42:38.000Z</published>
    <updated>2020-05-13T13:48:19.647Z</updated>
    
    <content type="html"><![CDATA[<p>查询状态S中是否有编号为 i 的点</p><pre class=" language-c++"><code class="language-c++">if(S & (1 << i)) return true;else return false;</code></pre><p>在状态 S 中添加编号为 i 的点</p><pre class=" language-c++"><code class="language-c++">S = S | (1 << i)</code></pre><p>在状态 S 中删除编号为 i 的点</p><pre><code>if(S &amp; (1 &lt;&lt; i))    S = S ^ (1 &lt;&lt; i);</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;查询状态S中是否有编号为 i 的点&lt;/p&gt;
&lt;pre class=&quot; language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;if(S &amp; (1 &lt;&lt; i)) return true;
else return false;&lt;/code&gt;&lt;/pre&gt;
      
    
    </summary>
    
    
    
      <category term="程序设计" scheme="http://LiuShuo1999.github.io/tags/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>To</title>
    <link href="http://liushuo1999.github.io/2020/05/11/T/"/>
    <id>http://liushuo1999.github.io/2020/05/11/T/</id>
    <published>2020-05-11T11:05:59.000Z</published>
    <updated>2020-05-11T11:14:30.170Z</updated>
    
    <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">birth</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="e946280ab40fff188d85531de34a60f1197e6bf2bcc4fa156c2a6895fd47db65">83cb0362696665ab864ce1998f50cdcae6e8f2204306c6924a163b5a3776530eb53fecbee382287f1e99bc758e2727fba7a2e376a53664fb8cd2fa66b2c52520433d39abba32aa2ce9769300c478e360dc31c502f71e741326e5228df41b4363eb5de9bbc295d31be4f179da09246c7cbf86e76d80cb7a747cddb20eddada5a350549cc82c85730bc518a030d5912b87bc0305be3772d9f0ee120f83b14fb2a960689dd93173b97f510e3228632b3b8994874b970bd550421f7a1e6ecde120401668c6bca566411856a8f7d476f5764bbbf9aaf761adeef5ae6860105cdd97f166f96307e1b5a64815d143432de6d097ca71d3686b1aa995cf26d88c39d3a1e6f856ef42da48da82c017dc865de2db69f26c2d1e25bc79a3bc97b10f6c10d3d63d6241d98df1ec6ecf3a72d16255042f355d9ee6201a073b0d69b3f0685d9e565592a2a7cb19abb7f7924c0b414e9ddc52feaa13d34606b19764d3c834a5c3352147d413c61f8dad7c1042d141fe729d785e44d55097b6cb6ea530e6de913011d338345574f33902b75b5d1260fa16adba51a6930f198b4252674903f61c39b69491dd8c7cadc66232887aef36fb9f6396cd06109ff7ff027c4a6704e3098607a77f6b52db730f99a3e5e33ae066d420229fbd0b8cc491261cb557654b14321e2f02dcbbc6e9c5fb594caa89d0ae44b041fff6793bf8d9a78677ac46b459eb5f629bb6ac22fa41fda00fc45756d04a3960bbc9bd11063f7da22f38de3a48e7ae725071aa206d32bdf6486a5de9f0a0793b2412e6c16ebf5256b1824c204ac23a5647403f91d239861b0720638c4d2340111b31c554642a4ef5a90ed50049d21b67622bcd23e573934a98df1e892b5b42f290e8a70d84dd785ec106bd8e2d4c1c8bdde1ef9f1ccd8caacf926b726b2fdd7b76fd6f45b8b869b085dd873da4e8759b4b2f249f8d9ab70de01c32fc58f08260f152fb31acfb60e570bb282115c176</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      something
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>随记</title>
    <link href="http://liushuo1999.github.io/2020/05/11/%E9%9A%8F%E8%AE%B0/"/>
    <id>http://liushuo1999.github.io/2020/05/11/%E9%9A%8F%E8%AE%B0/</id>
    <published>2020-05-11T08:15:24.000Z</published>
    <updated>2020-05-21T13:27:25.104Z</updated>
    
    <content type="html"><![CDATA[<h6 id="2020-05-11-晴"><a href="#2020-05-11-晴" class="headerlink" title="2020/05/11  晴"></a>2020/05/11  晴</h6><p>月下长饮一杯酒，怀念被写到泪流。月下卷入一莫愁，过往被写到泪流</p><h6 id="2020-05-14-小雨"><a href="#2020-05-14-小雨" class="headerlink" title="2020/05/14   小雨"></a>2020/05/14   小雨</h6><p>浮生有梦三千场，穷尽千里诗酒荒</p><h6 id="2020-05-18-晴"><a href="#2020-05-18-晴" class="headerlink" title="2020/05/18  晴"></a>2020/05/18  晴</h6><p>江雨霏霏江草齐，六朝如梦鸟空啼。<br><strong>无情最是台城柳</strong>，依旧烟笼十里堤。          —–唐.韦庄《台城|金陵图》</p><h5 id="2020-05-20-12-27"><a href="#2020-05-20-12-27" class="headerlink" title="2020/05/20/12:27"></a>2020/05/20/12:27</h5><p>点燃一场支离破碎的美梦</p><p>看光阴散落下的满眼绯红</p><h6 id="2020-05-21"><a href="#2020-05-21" class="headerlink" title="2020/05/21"></a>2020/05/21</h6><p>这世界的节奏太快了，快到没有时间看一下别人的建议。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h6 id=&quot;2020-05-11-晴&quot;&gt;&lt;a href=&quot;#2020-05-11-晴&quot; class=&quot;headerlink&quot; title=&quot;2020/05/11  晴&quot;&gt;&lt;/a&gt;2020/05/11  晴&lt;/h6&gt;&lt;p&gt;月下长饮一杯酒，怀念被写到泪流。月下卷入一莫愁，过往被写
      
    
    </summary>
    
    
    
      <category term="生活" scheme="http://LiuShuo1999.github.io/tags/%E7%94%9F%E6%B4%BB/"/>
    
      <category term="随记" scheme="http://LiuShuo1999.github.io/tags/%E9%9A%8F%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>书籍清单</title>
    <link href="http://liushuo1999.github.io/2020/05/11/%E4%B9%A6%E7%B1%8D%E6%B8%85%E5%8D%95/"/>
    <id>http://liushuo1999.github.io/2020/05/11/%E4%B9%A6%E7%B1%8D%E6%B8%85%E5%8D%95/</id>
    <published>2020-05-11T01:54:21.000Z</published>
    <updated>2020-05-12T01:08:11.947Z</updated>
    
    <content type="html"><![CDATA[<h6 id="Done"><a href="#Done" class="headerlink" title="Done"></a>Done</h6><p>大一上：NULL</p><p>大一下：</p><p>你只是假装很努力   √</p><p>三毛，上天独宠的追梦人  √</p><p>梦里花落知多少  √</p><p>雨季不再来  √</p><p>我们仨  √</p><p>天才在左疯子在右  √</p><p>追风筝的人  √</p><p>明朝那些事  √</p><p>孝经  √</p><p>大二：</p><p>许三观卖血记  √</p><p>人间失格  √</p><p>活着  √</p><p>了凡四训  √</p><p>你今天真好看  √</p><p>谁动了我的奶酪  √</p><p>大二</p><h6 id="Will"><a href="#Will" class="headerlink" title="Will"></a>Will</h6><p>摆渡人 ing</p><p>阿勒泰的角落 </p><p>瓦尔登湖</p><p>静静的顿河</p><p>偷影子的人</p><p>杀死一只知更鸟</p><p>鲁迅文集</p><p>云边有个小卖部</p><p><img src="/.io//C:%5CUsers%5Clenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200512090808739.png" alt="image-20200512090808739"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h6 id=&quot;Done&quot;&gt;&lt;a href=&quot;#Done&quot; class=&quot;headerlink&quot; title=&quot;Done&quot;&gt;&lt;/a&gt;Done&lt;/h6&gt;&lt;p&gt;大一上：NULL&lt;/p&gt;
&lt;p&gt;大一下：&lt;/p&gt;
&lt;p&gt;你只是假装很努力   √&lt;/p&gt;
&lt;p&gt;三毛，上天独宠的追梦人  √
      
    
    </summary>
    
    
      <category term="生活" scheme="http://LiuShuo1999.github.io/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
      <category term="书籍" scheme="http://LiuShuo1999.github.io/tags/%E4%B9%A6%E7%B1%8D/"/>
    
  </entry>
  
  <entry>
    <title>待看电影清单</title>
    <link href="http://liushuo1999.github.io/2020/05/10/%E5%BE%85%E7%9C%8B%E7%94%B5%E5%BD%B1%E6%B8%85%E5%8D%95/"/>
    <id>http://liushuo1999.github.io/2020/05/10/%E5%BE%85%E7%9C%8B%E7%94%B5%E5%BD%B1%E6%B8%85%E5%8D%95/</id>
    <published>2020-05-10T15:15:40.000Z</published>
    <updated>2020-05-11T02:18:02.608Z</updated>
    
    <content type="html"><![CDATA[<h1 id="电影清单"><a href="#电影清单" class="headerlink" title="电影清单"></a>电影清单</h1><p>可爱的骨头</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;电影清单&quot;&gt;&lt;a href=&quot;#电影清单&quot; class=&quot;headerlink&quot; title=&quot;电影清单&quot;&gt;&lt;/a&gt;电影清单&lt;/h1&gt;&lt;p&gt;可爱的骨头&lt;/p&gt;
&lt;script&gt;
        document.querySelectorAll(&#39;.github-
      
    
    </summary>
    
    
      <category term="生活" scheme="http://LiuShuo1999.github.io/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
      <category term="电影" scheme="http://LiuShuo1999.github.io/tags/%E7%94%B5%E5%BD%B1/"/>
    
      <category term="生活" scheme="http://LiuShuo1999.github.io/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>DP</title>
    <link href="http://liushuo1999.github.io/2020/05/10/%E5%8C%BA%E9%97%B4DP/"/>
    <id>http://liushuo1999.github.io/2020/05/10/%E5%8C%BA%E9%97%B4DP/</id>
    <published>2020-05-10T08:01:14.000Z</published>
    <updated>2020-05-13T14:13:28.233Z</updated>
    
    <content type="html"><![CDATA[<h1 id="区间DP"><a href="#区间DP" class="headerlink" title="区间DP"></a>区间DP</h1><p>什么是区间DP？</p><p>线性动态规划的一种扩展</p><p>在区间上进行的DP，通常是将大区间分割成小区间进行DP</p><p>在分阶段划分问题时，与阶段中元素出现的顺序和由前一阶段的哪写元素合并过来有很大关系</p><p>常见的转移方程类型</p><p><img src="/.io//C:%5CUsers%5Clenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200510160243296.png" alt="image-20200510160243296"></p><h4 id="题目：：："><a href="#题目：：：" class="headerlink" title="题目：：："></a>题目：：：</h4><p><a href="https://blog.csdn.net/mengxiang000000/article/details/73610401" target="_blank" rel="noopener">https://blog.csdn.net/mengxiang000000/article/details/73610401</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;区间DP&quot;&gt;&lt;a href=&quot;#区间DP&quot; class=&quot;headerlink&quot; title=&quot;区间DP&quot;&gt;&lt;/a&gt;区间DP&lt;/h1&gt;&lt;p&gt;什么是区间DP？&lt;/p&gt;
&lt;p&gt;线性动态规划的一种扩展&lt;/p&gt;
&lt;p&gt;在区间上进行的DP，通常是将大区间分割成小区间进行DP
      
    
    </summary>
    
    
    
      <category term="动态规划" scheme="http://LiuShuo1999.github.io/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"/>
    
      <category term="DP" scheme="http://LiuShuo1999.github.io/tags/DP/"/>
    
  </entry>
  
  <entry>
    <title>踩坑</title>
    <link href="http://liushuo1999.github.io/2020/05/10/%E8%B8%A9%E5%9D%91/"/>
    <id>http://liushuo1999.github.io/2020/05/10/%E8%B8%A9%E5%9D%91/</id>
    <published>2020-05-10T07:10:02.000Z</published>
    <updated>2020-05-14T09:37:33.088Z</updated>
    
    <content type="html"><![CDATA[<h1 id="错题整理"><a href="#错题整理" class="headerlink" title="错题整理"></a>错题整理</h1><p>1、注意数据范围，long long 10^18</p><p>2、注意行末空格问题</p><p>3、字符读入的换行问题</p><p><img src="/.io//C:%5CUsers%5Clenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200510151447168.png" alt="image-20200510151447168"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;错题整理&quot;&gt;&lt;a href=&quot;#错题整理&quot; class=&quot;headerlink&quot; title=&quot;错题整理&quot;&gt;&lt;/a&gt;错题整理&lt;/h1&gt;&lt;p&gt;1、注意数据范围，long long 10^18&lt;/p&gt;
&lt;p&gt;2、注意行末空格问题&lt;/p&gt;
&lt;p&gt;3、字符读入的换行问题&lt;
      
    
    </summary>
    
    
    
      <category term="程序设计" scheme="http://LiuShuo1999.github.io/tags/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
      <category term="错题" scheme="http://LiuShuo1999.github.io/tags/%E9%94%99%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>STL_map</title>
    <link href="http://liushuo1999.github.io/2020/05/10/STL-map/"/>
    <id>http://liushuo1999.github.io/2020/05/10/STL-map/</id>
    <published>2020-05-10T02:11:48.000Z</published>
    <updated>2020-05-26T07:53:12.164Z</updated>
    
    <content type="html"><![CDATA[<h1 id="map"><a href="#map" class="headerlink" title="map"></a>map</h1><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p>map的基本操作函数：<br>   C++ Maps是一种关联式容器，包含“关键字/值”对<br>   begin()     返回指向map头部的迭代器<br>   clear(）     删除所有元素<br>   count()     返回指定元素出现的次数<br>   empty()     如果map为空则返回true<br>   end()       返回指向map末尾的迭代器<br>   equal_range()  返回特殊条目的迭代器对<br>   erase()     删除一个元素<br>   find()      查找一个元素<br>   get_allocator() 返回map的配置器<br>   insert()     插入元素<br>   key_comp()    返回比较元素key的函数<br>   lower_bound()  返回键值&gt;=给定元素的第一个位置<br>   max_size()    返回可以容纳的最大元素个数<br>   rbegin()     返回一个指向map尾部的逆向迭代器<br>   rend()      返回一个指向map头部的逆向迭代器<br>   size()      返回map中元素的个数<br>   swap()      交换两个map<br>   upper_bound()   返回键值&gt;给定元素的第一个位置<br>   value_comp()   返回比较元素value的函数</p><h2 id="count函数"><a href="#count函数" class="headerlink" title="count函数"></a>count函数</h2><p>返回的是被查找元素的个数。如果有，返回1；否则，返回0。注意，map中不存在相同元素，所以返回值只能是1或0。</p><h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><p>  map&lt;int ,string&gt; maplive;<br>  1.maplive.insert(pair&lt;int,string&gt;(102,”aclive”));<br>  2.maplive.insert(map&lt;int,string&gt;::value_type(321,”hai”));<br>  3, maplive[112]=”April”;//map中最简单最常用的插入添加！</p><h2 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h2><pre class=" language-c++"><code class="language-c++">map<string,int>::iterator iter;//定义一个迭代指针iterfor(iter=M.begin(); iter!=M.end(); iter++)cout<<iter->first <<"->"<<iter->second<<endl;</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;map&quot;&gt;&lt;a href=&quot;#map&quot; class=&quot;headerlink&quot; title=&quot;map&quot;&gt;&lt;/a&gt;map&lt;/h1&gt;&lt;h2 id=&quot;基本操作&quot;&gt;&lt;a href=&quot;#基本操作&quot; class=&quot;headerlink&quot; title=&quot;基本操作&quot;&gt;&lt;/a&gt;基本操
      
    
    </summary>
    
    
    
      <category term="STL" scheme="http://LiuShuo1999.github.io/tags/STL/"/>
    
      <category term="map" scheme="http://LiuShuo1999.github.io/tags/map/"/>
    
  </entry>
  
  <entry>
    <title>观《美人鱼》有感</title>
    <link href="http://liushuo1999.github.io/2020/05/09/%E8%A7%82%E3%80%8A%E7%BE%8E%E4%BA%BA%E9%B1%BC%E3%80%8B%E6%9C%89%E6%84%9F/"/>
    <id>http://liushuo1999.github.io/2020/05/09/%E8%A7%82%E3%80%8A%E7%BE%8E%E4%BA%BA%E9%B1%BC%E3%80%8B%E6%9C%89%E6%84%9F/</id>
    <published>2020-05-09T11:20:33.000Z</published>
    <updated>2020-05-11T02:18:17.560Z</updated>
    
    <content type="html"><![CDATA[<h2 id="2020-05-09"><a href="#2020-05-09" class="headerlink" title="2020/05/09"></a>2020/05/09</h2><p>没看之前，一直以为是搞笑无厘头电影。</p><p>但是呢，在观影过程中星爷一直在向我们传递以下两种观点：</p><p>  1、提倡保护生态</p><p>  2、 反对“金钱至上”</p><blockquote><p> 突然想到一个点，插播一下，特别郁闷：为什么一部电影的精髓部分，像这个的生态、金钱至上论啊，这种反而倒是成为不了人们的饭后谈资，倒是一些搞笑无厘头的地方容易被称之为所谓的“名场面”。</p></blockquote><p>下面是看到的精彩的评论</p><p>场景:</p><p>若兰和刘轩在泳池见面，为了驱赶刘轩身边女孩们，将一块手表抛出并说谁拿到给谁。</p><p>映射:</p><p>女孩们并不认识手表的价值一普通 人不知道什么东西是真的值钱。</p><p>刘轩说这手表也就值800万一”也就” 表现了人拥有更多财富后对价值的藐视。</p><p>女孩们得知价值后都去抢手表了一普通人的对既得利益的总是， 以及随大流的盲从。</p><p>刘轩评价道“她们都是为了赚钱努力奋斗的年青人”一拥有特权的幸幸者对 “商品拜物主义”的认可。</p><blockquote><p>看到这位的评论，我突然想到高中做的语文阅读理解。hhhhhhhhhhhhhhh</p></blockquote><h2 id="触发其他的想法"><a href="#触发其他的想法" class="headerlink" title="触发其他的想法"></a>触发其他的想法</h2><p>有时候我总是感觉一直在忙碌，很少有时间停下来思考。</p><blockquote><p>以前我会觉得，看一部电影，哎，要1个多小时，会感觉不如去看会书什么什么的。其实不会，它也会带来别样的深思</p></blockquote><p>于是，知乎搜了一下“做什么是浪费时间”</p><p><img src="/.io//C:%5CUsers%5Clenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200509225759666.png" alt="image-20200509225759666"></p><p>偶然想起，24枚金币时间管理法的创始人，艾力。</p><p>无限的刷微博、刷朋友圈、自己给自己点个赞。一分一秒流逝后，又剩下什么呢？</p><blockquote><p>所以，在一段时间之后，你再也想不起你做过什么，到底带来了什么，这样的事情应该是无意义的事情吧</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;2020-05-09&quot;&gt;&lt;a href=&quot;#2020-05-09&quot; class=&quot;headerlink&quot; title=&quot;2020/05/09&quot;&gt;&lt;/a&gt;2020/05/09&lt;/h2&gt;&lt;p&gt;没看之前，一直以为是搞笑无厘头电影。&lt;/p&gt;
&lt;p&gt;但是呢，在观影过程中星爷
      
    
    </summary>
    
    
      <category term="生活" scheme="http://LiuShuo1999.github.io/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
      <category term="生活" scheme="http://LiuShuo1999.github.io/tags/%E7%94%9F%E6%B4%BB/"/>
    
      <category term="日记" scheme="http://LiuShuo1999.github.io/tags/%E6%97%A5%E8%AE%B0/"/>
    
      <category term="影评" scheme="http://LiuShuo1999.github.io/tags/%E5%BD%B1%E8%AF%84/"/>
    
  </entry>
  
  <entry>
    <title>后缀树(Ukkonen算法)</title>
    <link href="http://liushuo1999.github.io/2020/05/09/%E5%90%8E%E7%BC%80%E6%A0%91-Ukkonen%E7%AE%97%E6%B3%95/"/>
    <id>http://liushuo1999.github.io/2020/05/09/%E5%90%8E%E7%BC%80%E6%A0%91-Ukkonen%E7%AE%97%E6%B3%95/</id>
    <published>2020-05-09T03:29:06.000Z</published>
    <updated>2020-05-24T07:45:47.497Z</updated>
    
    <content type="html"><![CDATA[<h1 id="后缀树"><a href="#后缀树" class="headerlink" title="后缀树"></a>后缀树</h1><h5 id="可视化网站"><a href="#可视化网站" class="headerlink" title="可视化网站"></a><a href="https://brenden.github.io/ukkonen-animation/" target="_blank" rel="noopener">可视化网站</a></h5><h5 id="参考链接1–理论部分"><a href="#参考链接1–理论部分" class="headerlink" title="参考链接1–理论部分"></a><a href="https://www.cnblogs.com/xubenben/p/3484988.html" target="_blank" rel="noopener">参考链接1–理论部分</a></h5><h5 id="参考链接2–实操部分"><a href="#参考链接2–实操部分" class="headerlink" title="参考链接2–实操部分"></a><a href="https://www.cnblogs.com/xubenben/p/3486007.html" target="_blank" rel="noopener">参考链接2–实操部分</a></h5><h2 id="什么是后缀树？"><a href="#什么是后缀树？" class="headerlink" title="什么是后缀树？"></a>什么是后缀树？</h2><p>后缀树是一种搜索树，它描述了给定字符串的所有后缀，许多重要的字符串操作都能够在后缀树上快速地实现。</p><p><strong>定义</strong></p><p>一个长度为n的字符串S，它的后缀树定义为一棵满足如下条件的树：</p><ol><li><p>从根到树叶的路径与S的后缀一一对应。即每条路径惟一代表了S的一个后缀；</p></li><li><p>每条边都代表一个非空的字符串；</p></li><li><p>所有内部节点（根节点除外）都有至少两个子节点。</p></li></ol><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="后缀树构建（Ukkonen"><a href="#后缀树构建（Ukkonen" class="headerlink" title="后缀树构建（Ukkonen)"></a>后缀树构建（Ukkonen)</h2><pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cmath></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;algorithm></span></span><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;queue></span></span><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">int</span> MAXN <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">int</span> ALPHABET_SIZE <span class="token operator">=</span> <span class="token number">256</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">int</span> oo <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">25</span><span class="token punctuation">;</span><span class="token keyword">int</span> thelocation <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> pos<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//用于定位字符串中的字符的位置，，也即为外层的一个for循环</span><span class="token comment" spellcheck="true">//后缀树节点</span><span class="token keyword">struct</span> node <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//备注  [start,end)</span>    <span class="token keyword">int</span> start<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//字符串首位</span>    <span class="token keyword">int</span> end<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//字符串末位</span>    <span class="token keyword">int</span> slink<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//后缀链表指针</span>    <span class="token keyword">int</span> next<span class="token punctuation">[</span>ALPHABET_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//孩子指针 </span>    <span class="token keyword">int</span> location<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//后缀下标</span>    <span class="token keyword">int</span> father<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//仅仅在查找最大重复子串的时候适用，初始化为0</span>    <span class="token comment" spellcheck="true">//node() {</span>    <span class="token comment" spellcheck="true">//    location = -1;</span>    <span class="token comment" spellcheck="true">//}</span>    <span class="token keyword">int</span> <span class="token function">edge_length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">min</span><span class="token punctuation">(</span>end<span class="token punctuation">,</span> pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//返回表示边的长度 //"??"</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//声明大数组</span>node tree<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> MAXN<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//后缀树</span><span class="token keyword">class</span> <span class="token class-name">suffixtree</span> <span class="token punctuation">{</span><span class="token keyword">private</span><span class="token operator">:</span>    <span class="token keyword">int</span> root<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//后缀树根节点</span>    <span class="token keyword">int</span> last_added<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//后缀树上一次添加的节点，以便于增加后缀链表</span>    <span class="token keyword">int</span> treesize<span class="token punctuation">;</span>    <span class="token keyword">int</span> needSL<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//当形成一个内部节点时，更新needSL，用于添加后缀链表</span>    <span class="token keyword">int</span> Remainder<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//计数器Remainder: 记录我们在当前阶段需要插入的叶子节点数目。</span>    <span class="token keyword">int</span> active_node<span class="token punctuation">,</span> active_e<span class="token punctuation">,</span> active_len<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//活动三元组</span>    <span class="token keyword">int</span> termnum<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//用于找某个节点的所有叶子节点的内部变量</span>    <span class="token keyword">void</span> <span class="token function">numofleaf</span><span class="token punctuation">(</span><span class="token keyword">int</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>location <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            termnum<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ALPHABET_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token function">numofleaf</span><span class="token punctuation">(</span>tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">char</span> text<span class="token punctuation">[</span>MAXN<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">suffixtree</span><span class="token punctuation">(</span>string s<span class="token operator">=</span><span class="token string">"abc"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        needSL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        last_added <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        pos <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        Remainder <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//初始化三元组</span>        active_e <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> active_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        root <span class="token operator">=</span> active_node <span class="token operator">=</span> <span class="token function">new_node</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">st_extend</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        treesize <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">new_node</span><span class="token punctuation">(</span><span class="token keyword">int</span> start<span class="token punctuation">,</span> <span class="token keyword">int</span> end <span class="token operator">=</span> oo<span class="token punctuation">)</span> <span class="token punctuation">{</span>    node nd<span class="token punctuation">;</span>    nd<span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>    nd<span class="token punctuation">.</span>father <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    nd<span class="token punctuation">.</span>end <span class="token operator">=</span> end<span class="token punctuation">;</span>    nd<span class="token punctuation">.</span>slink <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ALPHABET_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        nd<span class="token punctuation">.</span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//添加后缀下标</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>end <span class="token operator">==</span> oo<span class="token punctuation">)</span> <span class="token punctuation">{</span>        nd<span class="token punctuation">.</span>location <span class="token operator">=</span> thelocation<span class="token punctuation">;</span>        thelocation<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> nd<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    tree<span class="token punctuation">[</span><span class="token operator">++</span>last_added<span class="token punctuation">]</span> <span class="token operator">=</span> nd<span class="token punctuation">;</span>    <span class="token keyword">return</span> last_added<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//active_e 是活跃的边在text内的序号</span><span class="token keyword">char</span> <span class="token function">active_edge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> text<span class="token punctuation">[</span>active_e<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//增加后缀链表 -> 当前内部节点(needSL)指向本阶段最近一次建立的内部节点(int node)</span><span class="token keyword">void</span> <span class="token function">add_SL</span><span class="token punctuation">(</span><span class="token keyword">int</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//加入后缀链表                                        </span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>needSL <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>tree<span class="token punctuation">[</span>needSL<span class="token punctuation">]</span><span class="token punctuation">.</span>slink <span class="token operator">=</span> node<span class="token punctuation">;</span>    needSL <span class="token operator">=</span> node<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//更新活动三元组</span><span class="token keyword">bool</span> <span class="token function">walk_down</span><span class="token punctuation">(</span><span class="token keyword">int</span> node<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>active_len <span class="token operator">>=</span> tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">edge_length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//判断是否更新活跃点，</span>        active_e <span class="token operator">+</span><span class="token operator">=</span> tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">edge_length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        active_len <span class="token operator">-</span><span class="token operator">=</span> tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">edge_length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        active_node <span class="token operator">=</span> node<span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//往后缀树中增加字符->c</span><span class="token keyword">void</span> <span class="token function">st_extend</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>    text<span class="token punctuation">[</span><span class="token operator">++</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//text是后缀树组</span>    needSL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//重置内部节点(needSL) //新的阶段</span>    Remainder<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>Remainder <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>active_len <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>active_e <span class="token operator">=</span> pos<span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//更新活跃边</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>tree<span class="token punctuation">[</span>active_node<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token function">active_edge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//? active_edge() 字符？</span>            <span class="token comment" spellcheck="true">//从根节点创建叶子节点</span>            <span class="token keyword">int</span> leaf <span class="token operator">=</span> <span class="token function">new_node</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>            tree<span class="token punctuation">[</span>active_node<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token function">active_edge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> leaf<span class="token punctuation">;</span>            <span class="token function">add_SL</span><span class="token punctuation">(</span>active_node<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> nxt <span class="token operator">=</span> tree<span class="token punctuation">[</span>active_node<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token function">active_edge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">walk_down</span><span class="token punctuation">(</span>nxt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//observation 2 //沿着活跃边往下走，并且可以越过一个点，即是否更新活跃点，当经过一个边所有的字符时，更新活跃点</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">[</span>tree<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">.</span>start <span class="token operator">+</span> active_len<span class="token punctuation">]</span> <span class="token operator">==</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//observation 1  新加入的字符，可以形成隐式树</span>                active_len<span class="token operator">++</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//更新活跃边长度</span>                <span class="token function">add_SL</span><span class="token punctuation">(</span>active_node<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//判断是否需要添加后缀链表 </span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">//从内部分裂--每次内部分裂都会形成一个叶子节点</span>            <span class="token keyword">int</span> split <span class="token operator">=</span> <span class="token function">new_node</span><span class="token punctuation">(</span>tree<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">.</span>start<span class="token punctuation">,</span> tree<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">.</span>start <span class="token operator">+</span> active_len<span class="token punctuation">)</span><span class="token punctuation">;</span>            tree<span class="token punctuation">[</span>active_node<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span><span class="token function">active_edge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> split<span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//构造叶子节点</span>            <span class="token keyword">int</span> leaf <span class="token operator">=</span> <span class="token function">new_node</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>            tree<span class="token punctuation">[</span>split<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> leaf<span class="token punctuation">;</span>            tree<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">.</span>start <span class="token operator">+</span><span class="token operator">=</span> active_len<span class="token punctuation">;</span>            tree<span class="token punctuation">[</span>split<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>text<span class="token punctuation">[</span>tree<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">.</span>start<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> nxt<span class="token punctuation">;</span>            <span class="token function">add_SL</span><span class="token punctuation">(</span>split<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//按照规则2更新三元组</span>        <span class="token punctuation">}</span>        Remainder<span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>active_node <span class="token operator">==</span> root <span class="token operator">&amp;&amp;</span> active_len <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//按照规则1更新三元组</span>            active_len<span class="token operator">--</span><span class="token punctuation">;</span>                              active_e <span class="token operator">=</span> pos <span class="token operator">-</span> Remainder <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span>            active_node <span class="token operator">=</span> tree<span class="token punctuation">[</span>active_node<span class="token punctuation">]</span><span class="token punctuation">.</span>slink <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> tree<span class="token punctuation">[</span>active_node<span class="token punctuation">]</span><span class="token punctuation">.</span>slink <span class="token operator">:</span> root<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//按照规则3更新三元组</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//判断是否存在子串T</span><span class="token keyword">bool</span> <span class="token function">search</span><span class="token punctuation">(</span>string T<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>T<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> treesize<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//找到第一个结点</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tree<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>T<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> nxt <span class="token operator">=</span> tree<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>T<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> T<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> tree<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">.</span>start<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> tree<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">.</span>end<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> T<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                i<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//遍历i结束</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> T<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//找到下一个节点</span>        nxt <span class="token operator">=</span> tree<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>T<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nxt<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        i<span class="token operator">--</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//更新i</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//return true;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//找到字符串出现的次数</span><span class="token keyword">int</span> <span class="token function">count</span><span class="token punctuation">(</span>string T<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>T<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> treesize<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//找到第一个结点</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tree<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>T<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> nxt <span class="token operator">=</span> tree<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>T<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> T<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> tree<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">.</span>start<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> tree<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">.</span>end<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> T<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                i<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">//遍历i结束</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> T<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    termnum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                    <span class="token function">numofleaf</span><span class="token punctuation">(</span>nxt<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span> termnum<span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//找到下一个节点</span>        nxt <span class="token operator">=</span> tree<span class="token punctuation">[</span>nxt<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>T<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nxt<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        i<span class="token operator">--</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//更新i</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//找到最长的重复子串</span><span class="token keyword">void</span> <span class="token function">longstring</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> qq<span class="token punctuation">;</span>    queue<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> ans<span class="token punctuation">;</span>    qq<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>qq<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> node <span class="token operator">=</span> qq<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        qq<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> node<span class="token number">-1</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"   node:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ALPHABET_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                cout <span class="token operator">&lt;&lt;</span> tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token string">" "</span> <span class="token punctuation">;</span>                termnum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token function">numofleaf</span><span class="token punctuation">(</span>tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>termnum <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>                qq<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                tree<span class="token punctuation">[</span>tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>father <span class="token operator">=</span> node<span class="token punctuation">;</span>                ans<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>next<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>          cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    string ans1<span class="token punctuation">;</span>    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> start1<span class="token punctuation">;</span>    <span class="token keyword">int</span> end1<span class="token punctuation">;</span>    <span class="token keyword">int</span> start2<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> end2<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    start1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    end1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>ans<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> node <span class="token operator">=</span> ans<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ans<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        start2<span class="token punctuation">[</span>num<span class="token punctuation">]</span> <span class="token operator">=</span> tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>start<span class="token punctuation">;</span>        end2<span class="token punctuation">[</span>num<span class="token punctuation">]</span> <span class="token operator">=</span> tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>end<span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>father <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            node <span class="token operator">=</span> tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>father<span class="token punctuation">;</span>            start2<span class="token punctuation">[</span>num<span class="token punctuation">]</span> <span class="token operator">=</span> tree<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">.</span>start<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>end2<span class="token punctuation">[</span>num<span class="token punctuation">]</span> <span class="token operator">-</span> start2<span class="token punctuation">[</span>num<span class="token punctuation">]</span> <span class="token operator">></span> end1 <span class="token operator">-</span> start1<span class="token punctuation">)</span> <span class="token punctuation">{</span>            start1 <span class="token operator">=</span> start2<span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">;</span>            end1 <span class="token operator">=</span> end2<span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        num<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//输出所有最长的重复子串</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>end2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> start2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span>end1 <span class="token operator">-</span> start1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> start2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> end2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                cout <span class="token operator">&lt;&lt;</span> text<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    string S<span class="token punctuation">,</span> T<span class="token punctuation">;</span>    S <span class="token operator">=</span> <span class="token string">"abcabxnmhnmj$"</span><span class="token punctuation">;</span>    suffixtree <span class="token function">t</span><span class="token punctuation">(</span>S<span class="token punctuation">)</span><span class="token punctuation">;</span>    t<span class="token punctuation">.</span><span class="token function">longstring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        cin <span class="token operator">>></span> T<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"YES"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"NO"</span><span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"number:"</span> <span class="token operator">&lt;&lt;</span> t<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="需要明确的问题"><a href="#需要明确的问题" class="headerlink" title="需要明确的问题"></a>需要明确的问题</h2><p>​        （理论层面</p><ol><li><p>后缀树的定义是什么？</p></li><li><p>后缀树能够高效解决哪些问题？</p></li><li><p>边和点的含义是什么？</p></li><li><p>隐式树和显示树各是什么？</p></li><li><p>（实现层面</p></li><li><p>三元组（活跃节点、活跃半径、活跃边）代表什么？</p></li><li><p>后缀链表是什么？</p></li><li><p>加边的时候的三个规则</p></li><li><p>‘$‘符号的意义？能不能用其他的代替’$‘？</p></li><li><p>举例一个过程,abcabcxabc$</p></li></ol><h2 id="待更…"><a href="#待更…" class="headerlink" title="待更…"></a>待更…</h2><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;后缀树&quot;&gt;&lt;a href=&quot;#后缀树&quot; class=&quot;headerlink&quot; title=&quot;后缀树&quot;&gt;&lt;/a&gt;后缀树&lt;/h1&gt;&lt;h5 id=&quot;可视化网站&quot;&gt;&lt;a href=&quot;#可视化网站&quot; class=&quot;headerlink&quot; title=&quot;可视化网站&quot;&gt;&lt;/a&gt;
      
    
    </summary>
    
    
    
      <category term="后缀树" scheme="http://LiuShuo1999.github.io/tags/%E5%90%8E%E7%BC%80%E6%A0%91/"/>
    
      <category term="数据结构" scheme="http://LiuShuo1999.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
      <category term="Ukkonen" scheme="http://LiuShuo1999.github.io/tags/Ukkonen/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://liushuo1999.github.io/2020/05/07/hello-world/"/>
    <id>http://liushuo1999.github.io/2020/05/07/hello-world/</id>
    <published>2020-05-07T15:49:03.004Z</published>
    <updated>2020-05-09T03:36:42.746Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h1 id="Hello-LS"><a href="#Hello-LS" class="headerlink" title="Hello LS"></a>Hello LS</h1><p>asdas</p><p>‘’’</p><p>asdas</p><p>‘’’</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Quick-Start&quot;&gt;&lt;a href=&quot;#Quick-Start&quot; class=&quot;headerlink&quot; title=&quot;Quick Start&quot;&gt;&lt;/a&gt;Quick Start&lt;/h2&gt;&lt;h1 id=&quot;Hello-LS&quot;&gt;&lt;a href=&quot;#Hello-LS&quot;
      
    
    </summary>
    
    
    
  </entry>
  
</feed>
